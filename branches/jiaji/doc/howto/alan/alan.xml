<?xml version="1.0"?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook XML V4.2//EN"
                  "http://www.oasis-open.org/docbook/xml/4.2/docbookx.dtd" 
[
  <!ENTITY uw "University of Washington">
  <!ENTITY dept "Department of Bioengineering">
  <!ENTITY user "<emphasis>alanwesthagen</emphasis>">
  <!ENTITY spkdn "<filename>spk.rfpk.washington.edu</filename>">
]>
<article><title>Being Alan Westhagen</title>
  <articleinfo>
    <abstract>
      <para>
	This document explains routine tasks that Alan Westhagen performed 
	the RFPK Software Team Leader.
      </para>
      <para>
	The information in this document is targeted primarily towards
	the RFPK Software Team and associates and is specific to the
	computer systems and network installed in the RFPK Laboratory
	of the &dept; of the &uw;.  RFPK is the Resource for
	Population Kinetics.  Its work is supported, in part, by grant
	P41 EB-001975 of the National Institutes of Health (NIH) of
	the U.S.  Department of Health and Human Services.
      </para>
      <para>
	<link linkend="copyright">Copyright</link> (c) 2005, by the &uw;.
      </para>
    </abstract>
    <revhistory>

      <revision>
	<revnumber>1.4</revnumber>
	<date>March 2, 2006</date>
	<authorinitials>ernst</authorinitials>
	<revremark>Bugzilla URL updated.</revremark>
      </revision>
          
      <revision>
	<revnumber>1.2</revnumber>
	<date>January 18, 2006</date>
	<authorinitials>ernst</authorinitials>
	<revremark>RHN Satellite server information.</revremark>
      </revision>
    
      <revision>
	<revnumber>1.0</revnumber>
	<date>May 16, 2005</date>
	<authorinitials>afw</authorinitials>
	<revremark>Initial version.</revremark>
      </revision>
    </revhistory>
  </articleinfo>
  <sect1>
    <title>Passwords</title>
    <para>
      Administering machines and software packages requires one to know a 
      lot of passwords.  Here is the method that Alan used at RFPK.
    </para>
    <sect2>
      <title>The File</title>
      <para>
	All usernames and passwords are kept in a single text file, which is
	always encrypted.  An unencrypted file is never allowed to remain
	on disk, except during the short time that it is being edited.
	The file has the pathname <filename>/root/pass.gpg</filename> and
	is encrypted with a conventional assymmetric cypher, using the
	command <command>gpg -c</command>.
      </para>
    </sect2>
    <sect2>
      <title>Reading the File</title>
      <para>
	If you want to look for a password in the file, you can read it
	without having to place an unencrypted copy of the file on disk,
	by using the following commands:
	<screen>
su -
gpg -d pass.gpg | less
	</screen>
      </para>
    </sect2>
    <sect2>
      <title>Finding a Password</title>
      <para>
	Suppose you want to find a password for whitechuck or for an application
	installed on whitechuck.  Here's an easy way to do that, with out 
	placing an unencrypted copy of the file on disk:
	<screen>
su -
gpg -d pass.gpg | grep whitechuck
	</screen>
      </para>
    </sect2>
    <sect2>
      <title>Changing the file</title>
      <para>
	If you need to make changes to the file, you will have to create
	one or more unencrypted copies on disk, depending on which editor
	you use.  <emphasis>Remove all unencrypted copies as soon as
	you have reencrypted the file.</emphasis>
      </para>
      <para>
	To get a plain text file, edit it with emacs, make a backup copy of 
	the file, reencrypt it and remove the plain text, do the following:
	<screen>
su -
gpg pass.gpg
cp pass.gpg pass.gpg.bak
emacs pass
gpg -c pass
rm pass pass~
	</screen>
      </para>
    </sect2>
  </sect1>
  <sect1 id="buy_sub">
    <title>Purchase RHN Subscriptions</title>
    <para>
      Each Linux machine must have a subscription
      to the RedHat Network (RHN) update service.  It does not matter whether
      the machine is used as a developer workstation or as a server.  
      RFPK uses <emphasis>RedHat Enterprise Linux Academic 
	Server Edition</emphasis> for all Linux machines.
    </para>
    <para>
      When adding a new 
      Linux computer the the set already in use at RFPK, it is much easier
      if the subscription for it is purchased before Linux is installed.
      RedHat has designed its installation process so that the first time
      the system is booted after all the software has been loaded, 
      additional configuration information is requested, including the
      account name for the RHN subscription.
    </para>
    <para>
      RedHat provides academic pricing, which costs much less than the 
      standard pricing.  The RedHat
      <ulink url="http://www.redhat.com/solutions/industries/education/products/">
	academic products
      </ulink>
      website is unclear about whether or not computers owned by the university,
      as opposed to those owned by students, faculty or staff, are eligible for
      this favorable pricing.  Ben Freeman, the RedHat sales representative 
      assigned to the educational industry group, affirm, however, that RFPK
      owned machines are eligible.
    </para>
    <para>
      To get academic pricing on a new subscription, and to have that subscription
      added to the account that we already have, is a bit tricky. If you 
      carefully do the following, it should work.
      <orderedlist>
	<listitem>
	  <para>
	    Go to the 
	    <ulink url="http://www.redhat.com/solutions/industries/education/products/">
	      RedHat Academic Products
	    </ulink>
	    website.
	  </para>
	  <para>
	    You will find that several products are listed.  You want
	    RedHat Enterprise Linux Academic <emphasis>Server</emphasis> Edition.
	    Click the <guibutton>Buy Individual Subscription</guibutton> link.
	  </para>
	</listitem>
	<listitem>
	  <para>
	    At the <emphasis>Individual Subscription</emphasis> page, click the
	    <guibutton>Subscribe Now</guibutton> link under 
	    RedHat Enterprise Linux Academic <emphasis>Server</emphasis> Edition.
	  </para>
	</listitem>
	<listitem>
	  <para>
	    On the <emphasis>Buy RedHat Enterprise Linux Academic Server Edition </emphasis>
	    page, you should be asked to log in.  
	    <emphasis>If you are not asked to log in,</emphasis> click the
	    <guibutton>Log in to Your Account</guibutton> link at the bottom of the page.
	  </para>
	  <para>
	    Log in using RFPK's RHN administrative login, &user;.  This is very
	    important; otherwise the subscriptions that you buy may not be 
	    associated with the pool of entitlements that RFPK already owns.
	  </para>
	</listitem>
	<listitem>
	  <para>
	    A page should appear, with most of the information already filled in.
	    You must provide the name of institution (&uw;), the last four
	    digits of your employee number (look on your Husky card), and must
	    attest that you are over 18 years of age.
	  </para>
	  <para>
	    Verify that the <emphasis>email</emphasis> field contains your 
	    email address.  If not, change to, so that verification of the order
	    and other RHN administrative mail will come to you.
	  </para>
	  <para>
	    After you have entered the information, click the <guibutton>Submit</guibutton>
	    button.
	  </para>
	</listitem>
	<listitem>
	  <para>
	    You will be presented with another page which, in essence, tells you that
	    your are qualified to purchase up to 40 copies.  
	    Click the <guibutton>Buy Now</guibutton> button.
	  </para>
	</listitem>
	<listitem>
	  <para>
	    You will then see an order contract.  You can fill in the number of copies
	    that you want and check the box that shows that you have read the license
	    agreement.  The click the
	    <guibutton>Checkout</guibutton> button.
	  </para>
	</listitem>
	<listitem>
	  <para>
	    Yet another page will appear.  Click the 
	    <guibutton>Proceed to Secure Checkout</guibutton> button.
	  </para>
	</listitem>
	<listitem>
	  <para>
	    On this page, you provide credit card information.  If you have a 
	    University of Washington ProCard, use it.  Otherwise, use a personal
	    credit card.  You can get reimbursed via the petty-cash reimbursement
	    system in place in the Bioengineering Department office.
	  </para>
	</listitem>
	<listitem>
	  <para>
	    Complete checkout.
	  </para>
	</listitem>
	<listitem>
	  <para>
	    You will receive an invoice by email.  Be sure to print this twice.
	    You will need one copy for reimbursement and the other for your 
	    records.
	  </para>
	</listitem>
      </orderedlist>
    </para>
  </sect1>
  <sect1>
    <title>Renew RHN Subscriptions</title>
    <para>
      A month or two in advance of the expiration of an RHN subscription, you will
      receive email from RHN encouraging you to renew.  The message contains a
      link to the renewal web site.  It is best to renew immediately, especially
      if the subscription is for the workstation (WS) edition.  The academic
      price of WS is $25, but it is not offered anymore, except for renewals.
      If you allow the subscription to expire, you will have to purchase an
      academic server (AS) subscription for $50. Even when you renew several
      months in advance of expiration, your credit card will not be charged 
      until the old subscription expires and the new subscription goes into
      effect.
    </para>
  </sect1>
  <sect1>
    <title>Using the University of Washington's RedHat Site Licences</title>
    <para>
      The University of Washington now maintains a satellite RedHat Network Server
      on campus, and has purchased a site-license for all University of Washington
      students, faculty and staff.  Configuring your computer to work with the 
      satellite server will enable updates to be performed using the up2date command 
      on either the workstation (WS) or advanced server (AS) editions of RedHat 
      Enterprise Linux versions 3 and 4.  The benefit of using this system is 
      primarily the savings of $25/subscription through RedHat.
    </para>
    <para>
      One consequence of using the University of Washingon's RedHat Linux site license
      is that RedHat will no longer provide customer support for your installation of 
      the software, and you are essentially on your own.  This should not be used unless
      you are very familiar with the Linux operating system, or you have a system
      administrator who is able to support your installation.
    </para>
    <para>
	  You may configure your computer to use the RHN Satellite server by following the
	  instructions as provided by the 
	  <ulink url="https://www.washington.edu/computing/linux/rhnsat.html">
	   Computing and Communication documentation
	  </ulink> on the subject.
    </para>
  </sect1>
  <sect1>
    <title>Install Linux on Additional Machines</title>
    <para>
      All of the workstations and servers in the RFPK Linux network run the same
      version of RedHat Enterprise Linux.  There are two different variants of this,
      however, one for each of the two processor architectures in use. The
      Sun V20z, which acts as the cspkserver, has the AMD-64 architecture.  All the
      others have the standard architecture.  This section outlines the process
      for installing the software whenever another machine is added to the collection.
    </para>
    <para>
      <orderedlist>
	<listitem>
	  <para>
	    Make sure that RFPK has a subscription (also called an 
	    entitlement) to the Redhat Network
	    (RHN) update service, that is not currently used for another machine.
	    To see the current subscriptions, go the 
	    <ulink url="https://rhn.redhat.com/network/systems/entitlements.pxt">
	      entitlements
	    </ulink>
	    web page and log in using the RFPK administrative login, &user;.
	    You will see a list of systems currently subscribed.  At the bottom
	    of the page you will see a line which reports the
	    number of subscriptions and the number of systems subscribed. 
	    If the number of subscriptions does not exceed the number of systems
	    subscribed, you will need to 
	    <link linkend="buy_sub">
	      purchase an additional subscription
	    </link>
	    before performing the installation.
	  </para>
	</listitem>
	<listitem>
	  <para>
	    Select the set of installation CDROMs appropriate for the version
	    of Linux being used and for the processor architecture of the machine
	    that will be the recipient of the software.  If the required CDROMs
	    cannot be located in the lab, you may have to 
	    download new images and burn them onto blank CD-Rs.
	  </para>
	  <para>
	    To find the appropriate images to download, go again to the
	    <ulink url="https://rhn.redhat.com/network/systems/entitlements.pxt">
	      entitlements
	    </ulink>,
	    and click on the <guibutton>Channels</guibutton> button in the bar near the
	    top of the page.  You will be transferred to a page which lists a 
	    lot of version/architecture pairs. Select the one that is correct for 
	    your target machine, and click that link.  After that, follow the
	    instructions in our
	    <ulink url="../burn-iso/burn-iso.html">
	      Downloading and Burning ISOs
	    </ulink>
	    document.
	  </para>
	</listitem>
	<listitem>
	  <para>
	    Place disk-1 of the set in the CD drive of the target machine and
	    boot.  If the machine does not boot from the CD, you will have to
	    go into the BIOS and change the booting order.
	  </para>
	</listitem>
	<listitem>
	  <para>
	    Once the bootstrap has loaded from the CD, you will be asked 
	    whether or not you would like to test the readability of your
	    CDROMs.  You should definitely do this, unless you have 
	    recently used these disks and know them to be sound.
	  </para>
	</listitem>
	<listitem>
	  <para>
	    Proceed with the installation.  Refer to the document
	    <ulink url="../OS-migrate/OS-migrate.html">
	      Operating System Version Migration
	    </ulink>
	    when trying to decide on options for packages, time base, etc.
	  </para>
	</listitem>
	<listitem>
	  <para>
	    After the installation is complete, the machine will reboot.
	    You will then be asked a series of questions, including 
	    those about registering with RHN.  When asked whether to
	    use and existing account, provide our username,
	    &user;.
	  </para>
	</listitem>
	<listitem>
	  <para>
	    The next time that the machine is booted, the installation 
	    will be complete.
	  </para>
	</listitem>
      </orderedlist>
    </para>
  </sect1>
  <sect1>
    <title>Check Cron and Logwatch Output</title>
    <para>
      Once a day, the email that root receives on whitechuck should be
      checked.  If any of the programs that <command>cron</command> runs
      automatically during the night has an error, email will be sent
      to the root user.  Once each night a program called <command>logwatch</command>
      filters the system log for what appear to be security breaches and sends
      the output to the the root user.
    </para>
    <para>
      To examine this output
      <screen>
ssh whitechuck
su -
pine
      </screen>
      then examine the mail in the inbox.
      <orderedlist>
	<listitem>
	  <para>
	    <emphasis>Cron:</emphasis> the system is backed up to tape Sunday 
	    morning by a program called <command>bru</command>.  At completion
	    of the backup run, an email summary is sent to root. Normally the
	    report will simply say that there were no errors. If more than
	    a handful of errors are reported, the backup should be run again.
	  </para>
	</listitem>
	<listitem>
	  <para>
	    LogWatch: the report has several sections of interest:
	    <orderedlist>
	      <listitem>
		<para>
		  <emphasis>pam-unix:</emphasis> pam is the authentication 
		  agent.  This section of the report summarizes authentication
		  failures.
		</para>
	      </listitem>
	      <listitem>
		<para>
		  <emphasis>SSHD:</emphasis> because the gateway/firewall
		  forwards <command>ssh</command> request to whitechuck, most
		  attempts by outsiders to log into 
		  <filename>spk.rfpk.washington.edu</filename> will be 
		  handled by the ssh daemon.  All attempts are listed.
		  Note: there is overlap between these attempts and those
		  listed in the pam-unix section.
		</para>
	      </listitem>
	    </orderedlist>
	  </para>
	</listitem>
      </orderedlist>
    </para>
  </sect1>
  <sect1>
    <title>Keep Systems Up-To-Date</title>
    <para>
      Keeping all of the Linux systems up-to-date is important for reliability
      and security.  RHN provides a web-accessible utility for making this
      easy.  Go to the RHN site which reports on 
      <ulink url="https://rhn.redhat.com/network/systems/system_list/visible_to_user.pxt">
	Systems
      </ulink>
      and check the status of your systems at least once a week.
      If the status shows that any of the systems have errata available,
      click the names of these systems to see what the errata pertain to.  If there
      are no errata for the Linux kernel, everything can be updated automatically from
      the web.  Simply check-mark each of the systems that have errata outstanding,
      click the <guibutton>Manage</guibutton> button, and then schedule the updates
      to occur as soon as possible.
    </para>
    <para>
      On any machine which has errata that pertain to the Linux kernel, the
      update cannot be done from the web.  Instead, the command
      <command>up2date</command> must be run by root on each of the machines,
      and then the machines rebooted.  In the case of the 
      development workstations, each developer should do this himself or herself.
      Send email, requesting this.  You will need to update the servers individually.
      The easiest way to handle this is to log in as an ordinary user, using
      <command>ssh</command>, use <command>su</command> to become root,
      and then to run <command>up2date</command>.
    </para>
  </sect1>
  <sect1>
    <title>Maintain Network Security</title>
    <para>
      For security and reliability, all of RFPK's Linux workstations and servers
      are only accessible from the public internet via a gateway server which
      serves as a firewall.  
    </para>
    <sect2>
      <title>Network Architecture</title>
      <para>
	A gateway/firewall is implemented with IpCop, which is a special version of Linux,
	and the following physical components:
	<orderedlist>
	  <listitem>
	    <para>
	      The gateway server, which is the
	      old HP Vectra PC, located in the back corner of the server area in our
	      lab in AERL.  The latches for the case cover of this machine are broken.
	      To open the case, just slide the top and sides, which are formed by
	      a single piece of folded sheet metal, forward.  This machine has
	      three separate ethernet network interface cards (NICs).
	    </para>
	  </listitem>
	  <listitem>
	    <para>
	      LinkSys 8-port ethernet switch for the DMZ network. It is connected
	      by <emphasis>orange</emphasis> CAT-5 patch cables to the gateway
	      server and to the web server.
	    </para>
	  </listitem>
	  <listitem>
	    <para>
	      Two Compex DSR2216 16-port ethernet switches, one located in a 
	      cubicle on the east side of the lab in AERL and the other in a
	      cubicle on the west side.  Together, these serve the LAN
	      network.  Using <emphasis>green</emphasis> CAT-5 patch cables, 
	      the west side switch is connected to the gateway server and to
	      all of the west side workstations and servers.  It is connected
	      to the east side switch with a blue CAT-5 patch cable with
	      green ends, that differs from the other cables in the lab in
	      that it is rated for service in an overhead plenum space.  The
	      east side switch is connected to the east side workstations
	      with green CAT-5 patch cables.
	    </para>
	  </listitem>
	  <listitem>
	    <para>
	      As already mentioned, CAT-5 patch cables:
	      <orderedlist>
		<listitem>
		  <para>
		    A red CAT-5 patch cable between one of the NICs in the 
		    gateway server and a wall socket.  The color red is
		    symbolic of the fact that the public internet,
		    also known as the red network, is dangerous.
		  </para>
		</listitem>
		<listitem>
		  <para>
		    Orange CAT-5 patch cables between one of the NICs in the
		    gateway server and the LinkSys switch and between the
		    switch and the web server.  The color orange is 
		    symbolic of the fact that the machines on the DMZ
		    network, also known as the orange network, are 
		    partially accessible to the public internet and,
		    hence, partially in danger.
		  </para>
		</listitem>
		<listitem>
		  <para>
		    Green CAT-5 patch cables, between one of the NICs in the
		    gateway server and the west side Compex switch, and
		    between both Compex switches and all workstations and
		    servers on the LAN.  The color green is symbolic of the
		    safety of the LAN compared to the public internet.
		  </para>
		</listitem>
		<listitem>
		  <para>
		    A blue plenum-rated CAT-5 patch cable, with green ends, which
		    connects the two Compex switches together, so that they
		    act, in essence, as one.  Because this is part of the green
		    network, it would have been preferable for the cable to be
		    green, but all that was available was a blue cable with 
		    green ends.  
		  </para>
		  <para>
		    This cable passes from one side of the lab to
		    the other, above the ceiling tiles, in what is known as the
		    heating and ventilating plenum.  If there were a fire and
		    ordinary cables were used, it is possible that the heat would
		    cause the insulation on the cables to release dangerous fumes
		    into the ventilation system.  The insulation on plenum-rated
		    cable has the property that it does not emit such fumes.
		  </para>
		</listitem>
	      </orderedlist>
	    </para>
	  </listitem>
	</orderedlist>
      </para>
    </sect2>
    <sect2>
      <title>Security Standards</title>
      <para>
	The following standards must be maintained:
	<orderedlist>
	  <listitem>
	    <para>
	      There must be <emphasis>no Microsoft Windows</emphasis>
	      behind the firewall, due to the manner in which the &uw;
	      network is administered and the ongoing vulnerability of
	      Windows to viruses and spyware.  Whenever administrators
	      in the &uw; Computing and Communications (C&amp;C)
	      department observe network traffic that indicates that a
	      subnetwork contains an infected computer, they shut the
	      entire subnetwork down, and only then attempt to
	      determine exactly which machine was misbehaving. The
	      subnetwork, which may contain many healthy machines as
	      well as the infected one, can be down for days,
	      completely disrupting the work of the
	      <quote>innocent</quote> bystanders.  This happened to
	      RFPK.  Only one Windows machine was infected, but all of
	      the Linux machines were placed off-line for days.  Our
	      current gateway architecture was implemented as a result
	      of that experience.  This is now even more important,
	      because we need to keep our servers up at all times, to
	      serve external users.
	    </para>
	    <para>
	      The gateway is connected to the university network at
	      only one place.  To C&amp;C, all of the workstations and
	      servers behind the gateway appear as a single host.  The
	      IP address of that host is the IP address of the
	      gateway.  Its domain name is &spkdn;. It is the sole
	      computer on its subnetwork, from the point of view of
	      C&amp;C.
	    </para>
	  </listitem>
	  <listitem>
	    <para>
	      All external access must be via the gateway. Never
	      bypass the gateway by connecting a workstation or server
	      directly to the university network.
	    </para>
	  </listitem>
	  <listitem>
	    <para>
	      All logins, with the exception of logins from an
	      attached keyboard and monitor, must be made via
	      <command>ssh</command>.  No telnet, rsh, or ftp, for
	      example.
	    </para>
	  </listitem>
	  <listitem>
	    <para>
	      All file transfers must be made via <command>scp</command>.
	      No rcp or ftp, for example.
	    </para>
	  </listitem>
	  <listitem>
	    <para>
	      External <command>ssh</command> connections are forwarded by 
	      the gateway to whitechuck.  This is the only means that is allowed
	      for logging in from the red network. 
	    </para>
	  </listitem>
	  <listitem>
	    <para>
	      The root user must not be permitted to log into whitechuck from
	      another computer. Because
	      all external logins are forwarded to whitechuck, this means that
	      to gain root access to the network an attacker must first guess the
	      username and password of an ordinary user, and then must guess the
	      root password.
	    </para>
	    <para>
	      This restriction is established by the following line in the file
	      <filename>/etc/ssh/sshd_config</filename>
	      <screen>
PermitRootLogin no
	      </screen>
	    </para>
	  </listitem>
	  <listitem>
	    <para>
	      Public key authentication is configured so that the root user
	      on whitechuck can transfer files via <command>scp</command>
	      to cspkserver and webserver without
	      providing a password. Details concerning this type of configuration
	      can be found 
	      <ulink url="../ssh/ssh.html#server-conf">
		here
	      </ulink>.
	    </para>
	  </listitem>
	</orderedlist>
      </para>
    </sect2>
    <sect2>
      <title>Maintain the IpCop Configuration</title>
      <para>
	IpCop is the software that enables the gateway computer to 
	act as a physical three-interface firewall.  It, in fact, a
	specialized version of Linux. The computer, which resides in 
	the far southwest corner of the lab, can be accessed via a 
	keyboard and monitor which are shared, by means of a kvm switch, with
	whitechuck and webserver.  It cannot be accessed using <command>ssh</command>
	because it is set up to forward any <command>ssh</command>
	connection to whitechuck.  By logging into the computer from
	the keyboard, you can perform Linux system administration.  This
	is almost never needed.
      </para>
      <para>
	The firewall features of IpCop are maintained via a set of
	administrative screens provided by a graphical user interface.
	This GUI is not accessible from the keyboard and monitor because,
	due to a mismatch between the graphics card in the gateway and
	that in whitechuck, a graphical desktop cannot be run on the
	gateway.  This is not a problem, however, because the
	IpCop configuration can be maintained via a
	<ulink url="https://192.168.1.1:445/cgi-bin/index.cgi">
	  web interface
	</ulink>
	from any workstation behind the firewall. The administrative
	screens are protected by a username (<emphasis>admin</emphasis>)
	and a password.
      </para>
      <para>
	The administrative web pages that are most frequently accessed are
	<guilabel>Services</guilabel> and <guilabel>System</guilabel>.
      </para>
      <sect3>
	<title>Services</title>
	<para>
	  Within <guilabel>Services</guilabel>, the pages that have been
	  used by RFPK for configuration are
	  <guilabel>dhcp</guilabel>, <guilabel>port forwarding</guilabel>,
	  <guilabel>external service access</guilabel>,
	  and <guilabel>dmz pinholes</guilabel>.
	</para>
	<sect4>
	  <title>Dhcp</title>
	  <para>
	    IpCop provides a dhcp server for the green network.  When
	    first added to the network, a host receives its IP address and 
	    certain other network configuration parameters from the dhcp 
	    server.  This simplifies system administration.
	  </para>
	  <para>
	    One side-effect of using a dhcp server is that the IP address can
	    change if a host is removed from the network and then later reconnected,
	    because the IP address may be reassigned to a different machine in the meantime.  
	    Processes in place at RFPK expect IP addresses not to change, however.
	    For example, the deployment script, <command>deploy_candidate.pl</command>,
	    copies files from aspkserver to cspkserver.  If the IP address of 
	    cspkserver were to change, the script would <quote>break</quote>.
	  </para>
	  <para>
	    Dhcp has a feature called the <emphasis>lease</emphasis> which keeps
	    an IP address from being reassigned immediately.  A host has a lease
	    on an address for a fixed period of time: 120 minutes, for example.
	    If the lease time is made very long, the IP address becomes, in effect,
	    fixed
	  </para>
	  <para>
	    When a host that is configured to use dhcp is connected to the 
	    network, it needs to discover what IP address to use.  It sends
	    a message to the dhcp server containing a unique code
	    which distinguishes it from every other computer
	    in the universe.  The code that is used is the MAC address of the
	    ethernet card that the host is using for the communication.  The
	    ethernet standard requires every card to have a unique MAC address.
	  </para>
	  <para>
	    When the dhcp server receives the MAC address from a host that is 
	    trying to discover its IP address, it first looks in a table to determine
	    whether or not that MAC address already has a lease on an IP.
	    If so, it sends the IP address back to the host; otherwise it creates
	    a new, temporary lease relating the MAC address with an IP address
	    that was currently unassigned.
	  </para>
	  <para>
	    The <guilabel>dhcp</guilabel> screen provides a simple
	    means for extending the time period of an existing lease
	    practically to infinity, effectively making it
	    <emphasis>fixed</emphasis>.  You simply enter the MAC
	    address and IP address of the lease in the fields
	    provided.
	  </para>
	  <para>
	    Here is the step-by-step procedure for adding a machine to the green network and
	    fixing its IP address:
	    <orderedlist>
	      <listitem>
		<para>
		  Physically connect the machine with a green CAT-5 patch cable to one of
		  two Compex ethernet switches.
		</para>
	      </listitem>
	      <listitem>
		<para>
		  The machine should connect immediately to the internet.  Check this,
		  pinging a well-known site:
		  <screen>
ping mit.edu
		  </screen>
		  If this
		  does not work, you may have to restart the network 
		  <screen>
su
/etc/rc.d/init.d/network restart
		  </screen>
		</para>
	      </listitem>
	      <listitem>
		<para>
		  In a shell window, execute <command>/sbin/ifconfig</command> to 
		  determine what the MAC address of the ethernet card is and what
		  IP address has been temporarily assigned by the dhcp server.  The
		  information is in the entry titled <quote>eth0</quote>.  The
		  MAC address is referred to as <quote>HWaddr</quote> and the
		  IP address as <quote>inet addr</quote>. 
		</para>
	      </listitem>
	      <listitem>
		<para>
		  In your browser, connect to the IpCop 
		  <ulink url="https://192.168.1.1:445/cgi-bin/index.cgi">
		    web interface
		  </ulink>.
		  Proceed to the <guilabel>Services</guilabel> screen and then
		  to the <guilabel>dhcp</guilabel> screen.
		</para>
	      </listitem>
	      <listitem>
		<para>
		  In the <guilabel>Add a new fixed lease</guilabel> section of the
		  web page, cut and paste the <quote>HWaddr</quote> value
		  and the <quote>inet addr</quote> value from the
		  ifconfig output in your shell window into the
		  <guilabel>MAC address</guilabel> and 
		  <guilabel>IP Address</guilabel> fields respectively.
		</para>
	      </listitem>
	      <listitem>
		<para>
		  Press the <guibutton>Add</guibutton> button to complete the
		  fixing of the lease.  The new (MAC address, IP address) pair
		  should appear in the <guilabel>Current fixed leases</guilabel>
		  list that appears at the bottom of the screen.
		</para>
	      </listitem>
	    </orderedlist>
	  </para>
	</sect4>
	<sect4>
	  <title>Port Forwarding</title>
	  <para>
	    The gateway has the domain name &spkdn; and the IP address
	    128.95.35.85.  None of the hosts behind the firewall have
	    domain names or IP addresses that are
	    <emphasis>routable</emphasis> (i.e. usable) on the
	    internet. Instead, all requests for services are directed
	    to &spkdn; and then routed, using network address
	    translation (NAT), by the gateway to the particular server
	    that provides that service.  For example, all requests for
	    ssh or scp, are forwarded to whitechuck.
	  </para>
	  <para>
	    To add an additional service to &spkdn; do the following:
	    <orderedlist>
	      <listitem>
		<para>
		  Select a port number which is currently not being
		  used for any service at &spkdn;. 
		</para>
		<para>
		  Consider as an example, the problem of making the
		  annual report application, which runs on whitechuck
		  port 80, accessible via the web. Because
		  &spkdn;<filename>:80</filename> was already used for
		  spk, port 80 was not available for the annual
		  report.  Instead, we decided on the external address
		  of &spkdn;<filename>:8082</filename>, and configured
		  the gateway to transfer all requests directed to
		  that address into requests to port 80 on
		  whitechuck.
		</para>
	      </listitem>
	      <listitem>
		<para>
		  Determine the internal IP address of the server.
		  (One way to do this is to look at the
		  <filename>/etc/hosts</filename> file on whitechuck).
		  In our example, the internal IP address was that of
		  whitechuck, which is
		  <filename>192.168.1.2</filename>.
		</para>
	      </listitem>
	      <listitem>
		<para>
		  Go from the IpCop <guilabel>Home</guilabel> page to the 
		  <guilabel>Services</guilabel> page to the
		  <guilabel>port forwarding</guilabel> page.  
		</para>
	      </listitem>
	      <listitem>
		<para>
		  Fill in the <guilabel>Source port</guilabel> field, the
		  <guilabel>Destination IP</guilabel> field and the
		  <guilabel>Destination port</guilabel> field.  In our example,
		  these would be 80, 192.168.1.2, and 8080, respectively.
		</para>
	      </listitem>
	      <listitem>
		<para>
		  If you want everyone on the public internet to be able to 
		  access this service, click the check box field labeled
		  <guilabel>Enabled</guilabel>.  On the other hand, if you 
		  intend to limit access, be sure that this field is blank,
		  for the time being.
		</para>
	      </listitem>
	      <listitem>
		<para>
		  Click the <guibutton>Add</guibutton> button.  The forwarding
		  rule should appear in the list at the bottom of the page.
		</para>
	      </listitem>
	      <listitem>
		<para>
		  If you are not intending to restrict access to this service,
		  you are through at this point.
		</para>
	      </listitem>
	      <listitem>
		<para>
		  To restrict access, find your new rule which should just have
		  been added to the list at the bottom of the page and click 
		  the plus sign. The <guilabel>Add a new rule</guilabel> portion
		  of the screen should change so that two fields are presented:
		  <guilabel>Remark</guilabel> and <guilabel>Source IP</guilabel>.
		</para>
	      </listitem>
	      <listitem>
		<para>
		</para>
	      </listitem>
	    </orderedlist>
	  </para>
	</sect4>
	<sect4>
	  <title>Dmz Pinholes</title>
	  <para>
	  </para>
	</sect4>
      </sect3>
      <sect3>
	<title>System</title>
	<para>
	</para>
      </sect3>
    </sect2>
  </sect1>
  <sect1>
    <title>Backup Administration</title>
    <para>
      The backup administrator takes overall responsibility for
      the backup processes.  The 
      <ulink url="../backup/backup.html">
	Backup
      </ulink> howto gives details.  
    </para>
    <para>
      On a weekly basis or, preferably, more frequently, the backup
      administrator should verify the following:
      <orderedlist>
	<listitem>
	  <para>
	    All developer home directories are being backed up to
	    the <filename>/usr/local/backup</filename> directory
	    on whitechuck.
	  </para>
	</listitem>
	<listitem>
	  <para>
	    Nightly symbolic dumps of the spkdb database are being
	    copied to <filename>/usr/local/backup</filename> on 
	    both whitechuck and cspkserver.
	  </para>
	</listitem>
	<listitem>
	  <para>
	    The weekly tape backup of whitechuck is occurring without
	    errors.
	  </para>
	</listitem>
      </orderedlist>
    </para>
  </sect1>
  <sect1>
    <title>Purchase Technical Books and Computer Hardware using ProCard</title>
    <para>
      Alan Westhagen used a Visa card issued by the &uw; under a program called
      <ulink url="http://www.washington.edu/admin/procard/index.htm">
	ProCard
      </ulink>
      to purchase technical books for the software team, and parts for
      the lab's computers. These are the practices that he followed:
      <itemizedlist>
	<listitem>
	  <para>
	    Always be sure to get an invoice or receipt that indicates what 
	    was bought.  When ordering on-line, print the order page as
	    well as any email confirmation.  When the goods arrive, 
	    look for an invoice in the package  or affixed to it.  As a
	    lasting record, keep the best of the invoices for a given
	    item, if there is more than one, and discard the others.
	  </para>
	</listitem>
	<listitem>
	  <para>
	    As soon as a purchase appears on the PaymentNet website,
	    verify it, and supply information about the purpose.
	    For example, "CD/RW drive for Mitch's workstation".
	  </para>
	</listitem>
	<listitem>
	  <para>
	    As soon as you have received the goods, make a copy
	    of the best invoice and send the original to the department
	    purchasing specialist (Amanda Matousek, MS-357962).
	  </para>
	</listitem>
	<listitem>
	  <para>
	    Early each month, a statement detailing ProCard activity
	    for the previous month becomes available on the web.
	    Print this report and attach copies of the invoices
	    for all purchases listed in the statement.  Keep this
	    as the RFPK record of the month's purchases.
	  </para>
	</listitem>
      </itemizedlist>
    </para>
  </sect1>
  <sect1>
    <title>Add New Users to the SPK Service</title>
    <sect2>
      <title>Information You Will Need</title>
    <para>
      New users must be added to both the spkdb database and to
      Bugzilla.  You will need the following information:
      <orderedlist>
	<listitem>
	  <para>
	    <emphasis>First Name.</emphasis> The user's given name.
	  </para>
	</listitem>
	<listitem>
	  <para>
	    <emphasis>Surname.</emphasis> The user's family name.
	  </para>
	</listitem>
	<listitem>
	  <para>
	    <emphasis>Username.</emphasis> Invent a user name. Hint:
	    you can often take the first part of the email address.
	  </para>
	</listitem>
	<listitem>
	  <para>
	    <emphasis>Password.</emphasis> Invent a strong password.
	    The user can change this later.
	  </para>
	</listitem>
	  <listitem>
	    <para>
	      <emphasis>Email.</emphasis> The user's email address.  
	      <emphasis>This is necessary for access to Bugzilla.</emphasis>
	    </para>
	  </listitem>
	  <listitem>
	    <para>
	      <emphasis>Company.</emphasis> The organization with which
	      the user is associated.
	    </para>
	  </listitem>
	  <listitem>
	    <para>
	      <emphasis>Country.</emphasis> The country where the user
	      resides.
	    </para>
	  </listitem>
	  <listitem>
	    <para>
	      <emphasis>State.</emphasis>  State, county, region, administrative 
	      department or blank. Whatever makes sense for the country
	      in question.
	    </para>
	  </listitem>
	</orderedlist>
      </para>
    </sect2>
    <sect2>
      <title>Add the User to the SPK Database</title>
      <para>
	Jiaji Du has a GUI tool for adding the above to spkdb.
      </para>
    </sect2>
    <sect2>
      <title>Add the User to Bugzilla</title>
      <para>
	Log into <ulink url="http://bugzilla.rfpk.washington.edu/index.cgi">
	  Bugzilla
	</ulink>.
	To add users, you must have the <emphasis>Editusers</emphasis>
	bit in your Bugzilla user privilege mask. If you do not have
	this privilege, the 
	<ulink url="http://192.168.2.2:8080/soft/howto/rhel3/bugzilla/bugzilla.html#usersect">
	  administrative user
	</ulink>
	can grant it to you.
      </para>
      <para>
	Assuming that you have the <emphasis>Editusers</emphasis> permission,
	here are the steps to follow for adding a new user to Bugzilla.
	<orderedlist>
	  <listitem>
	    <para>
	      Log into Bugzilla.
	    </para>
	  </listitem>
	  <listitem>
	    <para>
	      At the bottom of the main query page, there is a 
	      list of links to configuration information that you might
	      want to edit.  Click the <guilabel>users</guilabel>
	      link.
	    </para>
	  </listitem>
	  <listitem>
	    <para>
	      Somewhere near the middle of the user maintenance page,
	      click the <guilabel>Add a new user</guilabel> link.
	    </para>
	  </listitem>
	  <listitem>
	    <para>
	      On the <emphasis>Add user</emphasis> page, enter the
	      <emphasis>email address</emphasis> (not the username!)
	      in the field labeled
	      <guilabel>Login name</guilabel>.
	    </para>
	  </listitem>
	  <listitem>
	    <para>
	      In the <guilabel>Password</guilabel> field, enter the
	      same password that you entered into spkdb.
	    </para>
	  </listitem>
	  <listitem>
	    <para>
	      Fill in the user's real name, then click the
	      <guibutton>Add</guibutton> button.
	    </para>
	  </listitem>
	</orderedlist>
      </para>
    </sect2>
  </sect1>
  <sect1>
    <title id="copyright">Copyright Notice</title>
    <para>
      Copyright (c) 2005,  by the University of Washington.
      This material may be distributed only subject to the terms and conditions 
      set forth in the Open Publication License, V1.0 or later
      (the latest version is presently available
      <ulink url="http://www.opencontent.org/openpub/">here</ulink>.
    </para>
    <para>
    </para>
  </sect1>
</article>


<!--  LocalWords:  xml DOCTYPE DocBook uw articleinfo SPK RFPK RFPK's linkend
 -->
<!--  LocalWords:  ulink url alanwesthagen spkdn Westhagen revhistory afw RHN
 -->
<!--  LocalWords:  authorinitials revremark RedHat orderedlist listitem ProCard
 -->
<!--  LocalWords:  guibutton WS cspkserver AMD Redhat CDROMs ISOs username Cron
 -->
<!--  LocalWords:  Logwatch whitechuck cron logwatch su inbox bru LogWatch pam
 -->
<!--  LocalWords:  unix SSHD internet IpCop Vectra AERL ethernet NICs LinkSys
 -->
<!--  LocalWords:  Compex DSR spyware IP rsh scp rcp PermitRootLogin webserver
 -->
<!--  LocalWords:  conf kvm guilabel dhcp dmz aspkserver mit edu eth HWaddr spk
 -->
<!--  LocalWords:  inet addr ifconfig routable howto spkdb itemizedlist RW
 -->
<!--  LocalWords:  PaymentNet Matousek Bugzilla Jiaji Editusers usersect
 -->
