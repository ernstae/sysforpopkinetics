/**********************************************************************
From:   Resource Facility for Population Kinetics                    
        Department of Bioengineering Box 352255                      
        University of Washington                                     
        Seattle, WA 98195-2255                                       

This file is part of the System for Population Kinetics (SPK), which
was developed with support from NIH grants RR-12609 and P41-
EB001975. Please cite these grants in any publication for which this
software is used and send a notification to the address given above.

SPK is Copyright (C) 1998-2003, by the University of Washington,
Resource Facility for Population Kinetics, and is made available as
free open source software under the terms of the University of
Washington Free-Fork License as a public service.  A copy of the
License can be found in the COPYING file in the root directory of this
distribution.
**********************************************************************/
package uw.rfpk.mda.saamii.compartment;

import javax.swing.DefaultListModel;
import java.util.*;
import javax.swing.JList;
import javax.swing.JOptionPane;

/**
 *
 * @author  jiaji Du
 */
public class VariableDialog extends javax.swing.JDialog {
    
    /** Creates new form VariableDialog */
    public VariableDialog(java.awt.Frame parent) {
        super(parent, false);
        initComponents();
        
        setVariableList();
    }
    
    protected void setVariableList()
    {
        List keySet = new Vector(Model.variables.keySet());
        Iterator keyIter = keySet.iterator();
        String key, value;
        listModel.removeAllElements();
        while(keyIter.hasNext())
        {
            key = (String)keyIter.next();
            value = Model.variables.getProperty(key);
            if(value != null)
                listModel.addElement(key + " = " + value);
        }
        jList1.setModel(listModel);
    }
    
    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    private void initComponents() {//GEN-BEGIN:initComponents
        java.awt.GridBagConstraints gridBagConstraints;

        modelDialog = new javax.swing.JDialog();
        additionalRadioButton = new javax.swing.JRadioButton();
        proportionalRadioButton = new javax.swing.JRadioButton();
        exponentialRadioButton = new javax.swing.JRadioButton();
        userDefinedRadioButton = new javax.swing.JRadioButton();
        variableNameLabel = new javax.swing.JLabel();
        jTextArea1 = new javax.swing.JTextArea();
        jLabel3 = new javax.swing.JLabel();
        jLabel4 = new javax.swing.JLabel();
        jLabel5 = new javax.swing.JLabel();
        additionalLabel = new javax.swing.JLabel();
        jLabel7 = new javax.swing.JLabel();
        proportionalLabel = new javax.swing.JLabel();
        jLabel9 = new javax.swing.JLabel();
        exponentialLabel = new javax.swing.JLabel();
        jLabel11 = new javax.swing.JLabel();
        userDefinedTextField = new javax.swing.JTextField();
        jLabel12 = new javax.swing.JLabel();
        jLabel13 = new javax.swing.JLabel();
        jLabel14 = new javax.swing.JLabel();
        jLabel15 = new javax.swing.JLabel();
        jPanel5 = new javax.swing.JPanel();
        modelOKButton = new javax.swing.JButton();
        modelCancelButton = new javax.swing.JButton();
        modelHelpButton = new javax.swing.JButton();
        buttonGroup1 = new javax.swing.ButtonGroup();
        jScrollPane1 = new javax.swing.JScrollPane();
        jList1 = new javax.swing.JList();
        jLabel1 = new javax.swing.JLabel();
        jPanel1 = new javax.swing.JPanel();
        jButton1 = new javax.swing.JButton();
        jButton3 = new javax.swing.JButton();

        modelDialog.getContentPane().setLayout(new java.awt.GridBagLayout());

        modelDialog.setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        modelDialog.setTitle("Mixed Effect Model");
        modelDialog.setLocationRelativeTo(this);
        modelDialog.setModal(true);
        additionalRadioButton.setFont(new java.awt.Font("Dialog", 0, 12));
        additionalRadioButton.setSelected(true);
        additionalRadioButton.setText("Additional");
        buttonGroup1.add(additionalRadioButton);
        additionalRadioButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                additionalRadioButtonActionPerformed(evt);
            }
        });

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 3;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(5, 11, 5, 0);
        modelDialog.getContentPane().add(additionalRadioButton, gridBagConstraints);

        proportionalRadioButton.setFont(new java.awt.Font("Dialog", 0, 12));
        proportionalRadioButton.setText("Proportional");
        buttonGroup1.add(proportionalRadioButton);
        proportionalRadioButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                proportionalRadioButtonActionPerformed(evt);
            }
        });

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 4;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(5, 11, 5, 0);
        modelDialog.getContentPane().add(proportionalRadioButton, gridBagConstraints);

        exponentialRadioButton.setFont(new java.awt.Font("Dialog", 0, 12));
        exponentialRadioButton.setText("Exponential");
        buttonGroup1.add(exponentialRadioButton);
        exponentialRadioButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                exponentialRadioButtonActionPerformed(evt);
            }
        });

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 5;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(5, 11, 5, 0);
        modelDialog.getContentPane().add(exponentialRadioButton, gridBagConstraints);

        userDefinedRadioButton.setFont(new java.awt.Font("Dialog", 0, 12));
        userDefinedRadioButton.setText("User Defined");
        buttonGroup1.add(userDefinedRadioButton);
        userDefinedRadioButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                userDefinedRadioButtonActionPerformed(evt);
            }
        });

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 6;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.SOUTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(5, 12, 0, 0);
        modelDialog.getContentPane().add(userDefinedRadioButton, gridBagConstraints);

        variableNameLabel.setText("Variable Name:");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridwidth = 4;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(13, 13, 0, 13);
        modelDialog.getContentPane().add(variableNameLabel, gridBagConstraints);

        jTextArea1.setBackground(new java.awt.Color(204, 204, 204));
        jTextArea1.setText("Select or enter a mixed effect model for the variable.  A model\nmay consists of a fixed effect parameter THETA and a random \neffect parameter ETA.  THETA is to model the behavior of the \nwhole population and ETA is to model the behavior variations \namong the individual subjects.  Make sure that an appropriate \nnumber is inserted in each parenthesis folowing a parameter.");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.gridwidth = 4;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(12, 12, 12, 12);
        modelDialog.getContentPane().add(jTextArea1, gridBagConstraints);

        jLabel3.setText("Model Name");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.insets = new java.awt.Insets(0, 12, 5, 0);
        modelDialog.getContentPane().add(jLabel3, gridBagConstraints);

        jLabel4.setText("Expression");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(0, 5, 5, 0);
        modelDialog.getContentPane().add(jLabel4, gridBagConstraints);

        jLabel5.setText("Distribution");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 2;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(0, 12, 5, 0);
        modelDialog.getContentPane().add(jLabel5, gridBagConstraints);

        additionalLabel.setFont(new java.awt.Font("Dialog", 0, 12));
        additionalLabel.setText("THETA + ETA");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 3;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(0, 5, 0, 0);
        modelDialog.getContentPane().add(additionalLabel, gridBagConstraints);

        jLabel7.setFont(new java.awt.Font("Dialog", 0, 12));
        jLabel7.setText("Normal");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 2;
        gridBagConstraints.gridy = 3;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(0, 12, 0, 0);
        modelDialog.getContentPane().add(jLabel7, gridBagConstraints);

        proportionalLabel.setFont(new java.awt.Font("Dialog", 0, 12));
        proportionalLabel.setText("THETA + THETA * ETA");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 4;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(0, 5, 0, 0);
        modelDialog.getContentPane().add(proportionalLabel, gridBagConstraints);

        jLabel9.setFont(new java.awt.Font("Dialog", 0, 12));
        jLabel9.setText("Normal");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 2;
        gridBagConstraints.gridy = 4;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(0, 12, 0, 0);
        modelDialog.getContentPane().add(jLabel9, gridBagConstraints);

        exponentialLabel.setFont(new java.awt.Font("Dialog", 0, 12));
        exponentialLabel.setText("THETA * EXP(ETA)");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 5;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(0, 5, 0, 0);
        modelDialog.getContentPane().add(exponentialLabel, gridBagConstraints);

        jLabel11.setFont(new java.awt.Font("Dialog", 0, 12));
        jLabel11.setText("Lognormal");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 2;
        gridBagConstraints.gridy = 5;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(0, 12, 0, 0);
        modelDialog.getContentPane().add(jLabel11, gridBagConstraints);

        userDefinedTextField.setText("THETA() + ETA()");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 6;
        gridBagConstraints.gridwidth = 3;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 0, 12);
        modelDialog.getContentPane().add(userDefinedTextField, gridBagConstraints);

        jLabel12.setFont(new java.awt.Font("Dialog", 0, 12));
        jLabel12.setText("Note: Here ETA is a zero mean Normal random variable in SPK.");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 7;
        gridBagConstraints.gridwidth = 4;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(8, 12, 0, 12);
        modelDialog.getContentPane().add(jLabel12, gridBagConstraints);

        jLabel13.setIcon(new javax.swing.ImageIcon(getClass().getResource("/uw/rfpk/mda/saamii/compartment/normal.jpg")));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 3;
        gridBagConstraints.gridy = 3;
        gridBagConstraints.insets = new java.awt.Insets(0, 0, 0, 12);
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        modelDialog.getContentPane().add(jLabel13, gridBagConstraints);

        jLabel14.setIcon(new javax.swing.ImageIcon(getClass().getResource("/uw/rfpk/mda/saamii/compartment/normal.jpg")));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 3;
        gridBagConstraints.gridy = 4;
        gridBagConstraints.insets = new java.awt.Insets(0, 0, 0, 12);
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        modelDialog.getContentPane().add(jLabel14, gridBagConstraints);

        jLabel15.setIcon(new javax.swing.ImageIcon(getClass().getResource("/uw/rfpk/mda/saamii/compartment/lognormal.jpg")));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 3;
        gridBagConstraints.gridy = 5;
        gridBagConstraints.insets = new java.awt.Insets(0, 0, 0, 12);
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        modelDialog.getContentPane().add(jLabel15, gridBagConstraints);

        modelOKButton.setText("OK");
        modelOKButton.setPreferredSize(new java.awt.Dimension(75, 25));
        modelOKButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                modelOKButtonActionPerformed(evt);
            }
        });

        jPanel5.add(modelOKButton);

        modelCancelButton.setText("Cancel");
        jPanel5.add(modelCancelButton);

        modelHelpButton.setText("Help");
        modelHelpButton.setPreferredSize(new java.awt.Dimension(75, 25));
        jPanel5.add(modelHelpButton);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 8;
        gridBagConstraints.gridwidth = 4;
        gridBagConstraints.insets = new java.awt.Insets(12, 12, 12, 12);
        modelDialog.getContentPane().add(jPanel5, gridBagConstraints);

        setTitle("Variable List");
        setLocationRelativeTo(this);
        addWindowListener(new java.awt.event.WindowAdapter() {
            public void windowClosing(java.awt.event.WindowEvent evt) {
                closeDialog(evt);
            }
        });

        jList1.setSelectionMode(javax.swing.ListSelectionModel.SINGLE_SELECTION);
        jList1.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jList1MouseClicked(evt);
            }
        });

        jScrollPane1.setViewportView(jList1);

        getContentPane().add(jScrollPane1, java.awt.BorderLayout.CENTER);

        jLabel1.setFont(new java.awt.Font("Dialog", 0, 12));
        jLabel1.setText("Select one to modify");
        getContentPane().add(jLabel1, java.awt.BorderLayout.NORTH);

        jButton1.setText("OK");
        jButton1.setPreferredSize(new java.awt.Dimension(75, 25));
        jPanel1.add(jButton1);

        jButton3.setText("Help");
        jButton3.setPreferredSize(new java.awt.Dimension(75, 25));
        jPanel1.add(jButton3);

        getContentPane().add(jPanel1, java.awt.BorderLayout.SOUTH);

        pack();
    }//GEN-END:initComponents

    private void userDefinedRadioButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_userDefinedRadioButtonActionPerformed
        userDefinedTextField.setText("");
    }//GEN-LAST:event_userDefinedRadioButtonActionPerformed

    private void exponentialRadioButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_exponentialRadioButtonActionPerformed
        userDefinedTextField.setText("THETA() + EXP(ETA())");
    }//GEN-LAST:event_exponentialRadioButtonActionPerformed

    private void additionalRadioButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_additionalRadioButtonActionPerformed
        userDefinedTextField.setText("THETA() + ETA()");
    }//GEN-LAST:event_additionalRadioButtonActionPerformed

    private void proportionalRadioButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_proportionalRadioButtonActionPerformed
        userDefinedTextField.setText("THETA() + THETA() * ETA()");
    }//GEN-LAST:event_proportionalRadioButtonActionPerformed

    private void jList1MouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jList1MouseClicked
        index = jList1.getSelectedIndex();
        variable = ((String)jList1.getSelectedValue()).split(" = ")[0];
        variableNameLabel.setText("Variable Name: " + variable);
        modelExpression = Model.variables.getProperty(variable);
        if(!modelExpression.equals("?"))
        {
            if(modelExpression.equals(additionalLabel.getText()))
                additionalRadioButton.setSelected(true);
            else if(modelExpression.equals(proportionalLabel.getText()))
                proportionalRadioButton.setSelected(true);
            else if(modelExpression.equals(exponentialLabel.getText()))
                exponentialRadioButton.setSelected(true);
            else userDefinedRadioButton.setSelected(true);
        }
        else additionalRadioButton.setSelected(true);
        modelDialog.setSize(425, 415);
        modelDialog.setVisible(true);        
    }//GEN-LAST:event_jList1MouseClicked

    private void modelOKButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_modelOKButtonActionPerformed
        modelExpression = userDefinedTextField.getText().trim();
        if(modelExpression.equals(""))
        {
            JOptionPane.showMessageDialog(null, "The variable's mixed effect model has not been defined.",
                                          "Error Message", JOptionPane.ERROR_MESSAGE);
            return;
        }
        Model.variables.setProperty(variable, modelExpression);
        listModel.setElementAt(variable + " = " + modelExpression, index);
        setVariableList();
        modelDialog.setVisible(false);
    }//GEN-LAST:event_modelOKButtonActionPerformed
    
    /** Closes the dialog */
    private void closeDialog(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_closeDialog
        setVisible(false);
        dispose();
    }//GEN-LAST:event_closeDialog
    
    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        new VariableDialog(new javax.swing.JFrame()).show();
    }
    
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JLabel additionalLabel;
    private javax.swing.JRadioButton additionalRadioButton;
    private javax.swing.ButtonGroup buttonGroup1;
    private javax.swing.JLabel exponentialLabel;
    private javax.swing.JRadioButton exponentialRadioButton;
    private javax.swing.JButton jButton1;
    private javax.swing.JButton jButton3;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel11;
    private javax.swing.JLabel jLabel12;
    private javax.swing.JLabel jLabel13;
    private javax.swing.JLabel jLabel14;
    private javax.swing.JLabel jLabel15;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JLabel jLabel9;
    private javax.swing.JList jList1;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel5;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JTextArea jTextArea1;
    private javax.swing.JButton modelCancelButton;
    protected javax.swing.JDialog modelDialog;
    private javax.swing.JButton modelHelpButton;
    private javax.swing.JButton modelOKButton;
    private javax.swing.JLabel proportionalLabel;
    private javax.swing.JRadioButton proportionalRadioButton;
    private javax.swing.JRadioButton userDefinedRadioButton;
    private javax.swing.JTextField userDefinedTextField;
    private javax.swing.JLabel variableNameLabel;
    // End of variables declaration//GEN-END:variables

    DefaultListModel listModel = new DefaultListModel();
    String variable, modelExpression;
    int index = -1;
}
