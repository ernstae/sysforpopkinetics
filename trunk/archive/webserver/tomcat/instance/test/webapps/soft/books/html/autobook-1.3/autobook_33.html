<HTML>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<!-- Created on May, 24  2001 by texi2html 1.64 -->
<!-- 
Written by: Lionel Cons <Lionel.Cons@cern.ch> (original author)
            Karl Berry  <karl@freefriends.org>
            Olaf Bachmann <obachman@mathematik.uni-kl.de>
            and many others.
Maintained by: Olaf Bachmann <obachman@mathematik.uni-kl.de>
Send bugs and suggestions to <texi2html@mathematik.uni-kl.de>
 
-->
<HEAD>
<TITLE>Autoconf, Automake, and Libtool: What to check for</TITLE>

<META NAME="description" CONTENT="Autoconf, Automake, and Libtool: What to check for">
<META NAME="keywords" CONTENT="Autoconf, Automake, and Libtool: What to check for">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<META NAME="Generator" CONTENT="texi2html 1.64">
<script language="Javascript">
<!--    
// Check the browser version.

    function checkVersion() {
      if (navigator.appVersion.charAt(0)>=3) return true;
      if (navigator.appVersion.charAt(0)>=4) return true;
      else return false;
    }

      if (checkVersion()) {
             homeon = new Image();
             homeon.src = "homeon.png";

             homeoff = new Image();
             homeoff.src = "home.png";

             tocon = new Image();
             tocon.src = "tocon.png";

             tocoff = new Image();
             tocoff.src = "toc.png";

             indexon = new Image();
             indexon.src = "indexon.png";

             indexoff = new Image();
             indexoff.src = "index.png";

             helpon = new Image();
             helpon.src = "helpon.png";

             helpoff = new Image();
             helpoff.src = "help.png";

             backon = new Image();
             backon.src = "backon.png";

             backoff = new Image();
             backoff.src = "back.png";

             forwardon = new Image();
             forwardon.src = "forwardon.png";

             forwardoff = new Image();
             forwardoff.src = "forward.png";

             prevon = new Image();
             prevon.src = "prevon.png";

             prevoff = new Image();
             prevoff.src = "prev.png";

             nexton = new Image();
             nexton.src = "nexton.png";

             nextoff = new Image();
             nextoff.src = "next.png";

             upon = new Image();
             upon.src = "upon.png";

             upoff = new Image();
             upoff.src = "up.png";
         }

     function img_act(imgName) {
             if (checkVersion()) {
             imgOn = eval(imgName + "on.src");
             document [imgName].src = imgOn;
             }
     }

     function img_inact(imgName) {
             if (checkVersion()) {
             imgOff = eval(imgName + "off.src");
             document [imgName].src = imgOff;
             }
     }
// -->
</SCRIPT>

</HEAD>

<BODY LANG="EN" BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#6688AA" VLINK="#336688" ALINK="#808080">

<A NAME="SEC33"></A>
<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=10>
<TR VALIGN="TOP">
<TD ALIGN="MIDDLE" WIDTH=50 BGCOLOR="#e6e6e6">
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR VALIGN="TOP" ALIGN="LEFT">
<TD VALIGN="MIDDLE" ALIGN="LEFT"><A HREF="autobook_32.html#SEC32" onMouseover="img_act('prev')" onMouseout="img_inact('prev')"><IMG SRC="prev.png" BORDER="0" ALT="Back: Ordering Tests" ALIGN="MIDDLE" NAME="prev"></A></TD>
</TR>
<TR VALIGN="TOP" ALIGN="LEFT">
<TD VALIGN="MIDDLE" ALIGN="LEFT"><A HREF="autobook_34.html#SEC34" onMouseover="img_act('next')" onMouseout="img_inact('next')"><IMG SRC="next.png" BORDER="0" ALT="Forward: Using Configuration Names" ALIGN="MIDDLE" NAME="next"></A></TD>
</TR>
<TR VALIGN="TOP" ALIGN="LEFT">
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TR VALIGN="TOP" ALIGN="LEFT">
<TD VALIGN="MIDDLE" ALIGN="LEFT"><A HREF="autobook_34.html#SEC34" onMouseover="img_act('back')" onMouseout="img_inact('back')"><IMG SRC="back.png" BORDER="0" ALT="FastBack: Using Configuration Names" ALIGN="MIDDLE" NAME="back"></A></TD>
</TR>
<TR VALIGN="TOP" ALIGN="LEFT">
<TD VALIGN="MIDDLE" ALIGN="LEFT"><A HREF="autobook_29.html#SEC29" onMouseover="img_act('up')" onMouseout="img_inact('up')"><IMG SRC="up.png" BORDER="0" ALT="Up: Writing configure.in" ALIGN="MIDDLE" NAME="up"></A></TD>
</TR>
<TR VALIGN="TOP" ALIGN="LEFT">
<TD VALIGN="MIDDLE" ALIGN="LEFT"><A HREF="autobook_35.html#SEC35" onMouseover="img_act('forward')" onMouseout="img_inact('forward')"><IMG SRC="forward.png" BORDER="0" ALT="FastForward: Introducing GNU Automake" ALIGN="MIDDLE" NAME="forward"></A></TD>
</TR>
<TR VALIGN="TOP" ALIGN="LEFT">
<TD VALIGN="MIDDLE" ALIGN="LEFT"><A HREF="autobook.html#SEC_Top" onMouseover="img_act('home')" onMouseout="img_inact('home')"><IMG SRC="home.png" BORDER="0" ALT="Top: Autoconf, Automake, and Libtool" ALIGN="MIDDLE" NAME="home"></A></TD>
</TR>
<TR VALIGN="TOP" ALIGN="LEFT">
<TD VALIGN="MIDDLE" ALIGN="LEFT"><A HREF="autobook_toc.html#SEC_Contents" onMouseover="img_act('toc')" onMouseout="img_inact('toc')"><IMG SRC="toc.png" BORDER="0" ALT="Contents: Table of Contents" ALIGN="MIDDLE" NAME="toc"></A></TD>
</TR>
<TR VALIGN="TOP" ALIGN="LEFT">
<TD VALIGN="MIDDLE" ALIGN="LEFT"><A HREF="autobook_285.html#SEC285" onMouseover="img_act('index')" onMouseout="img_inact('index')"><IMG SRC="index.png" BORDER="0" ALT="Index: Index" ALIGN="MIDDLE" NAME="index"></A></TD>
</TR>
<TR VALIGN="TOP" ALIGN="LEFT">
<TD VALIGN="MIDDLE" ALIGN="LEFT"><A HREF="autobook_abt.html#SEC_About" onMouseover="img_act('help')" onMouseout="img_inact('help')"><IMG SRC="help.png" BORDER="0" ALT="About: About this document" ALIGN="MIDDLE" NAME="help"></A></TD>
</TR>
</TABLE>
</TD>
<TD ALIGN="LEFT">
<H2> 6.4 What to check for </H2>
<!--docid::SEC33::-->
<P>

Deciding what to check for is really the central part of writing
<TT>`configure.in'</TT>.  Once you've read the Autoconf reference manual,
the "how"s of writing a particular test should be fairly clear.  The
"when"s might remain a mystery -- and it's just as easy to check for too
many things as it is to check for too few.
</P><P>

One notable area of divergence between various Unix-like systems is that
the same programs don't exist on all systems, and, even when they do,
they don't always work in the same way.  For these problems we
recommend, when possible, following the advice of the GNU Coding
Standards: use the most common options from a relatively limited set of
programs.  Failing that, try to stick to programs and options specified
by POSIX, perhaps augmenting this approach by doing checks for known
problems on platforms you care about.
</P><P>

Checking for tools and their differences is usually a fairly small part
of a <TT>`configure'</TT> script; more common are checks for functions,
libraries, and the like.
</P><P>

Except for a few core libraries like <TT>`libc'</TT> and, usually,
<TT>`libm'</TT> and libraries like <TT>`libX11'</TT> which typically aren't
considered system libraries, there isn't much agreement about library
names or contents between Unix systems.  Still, libraries are easy to
handle, because decisions about libraries almost always only affect the
various <TT>`Makefile'</TT>s.  That means that checking for another library
typically doesn't require major (or even, sometimes, any) changes to the
source code.  Also, because adding a new library test has a small impact
on the development cycle -- effectively just re-running <TT>`configure'</TT>
and then a relink -- you can effectively adopt a lax approach to
libraries.  For instance, you can just make things work on the few
systems you immediately care about and then handle library changes on an
as-needed basis.
</P><P>

Suppose you do end up with a link problem.  How do you handle it?  The
first thing to do is use <CODE>nm</CODE> to look through the system libraries
to see if the missing function exists.  If it does, and it is in a
library you can use then the solution is easy -- just add another
<CODE>AC_CHECK_LIB</CODE>.  Note that just finding the function in a library
is not enough, because on some systems, some "standard" libraries are
undesirable; <TT>`libucb'</TT> is the most common example of a library which
you should avoid.
</P><P>

If you can't find the function in a system library then you have a
somewhat more difficult problem: a non-portable function.  There are
basically three approaches to a missing function.  Below we talk about
functions, but really these same approaches apply, more or less, to
typedefs, structures, and global variables.
</P><P>

The first approach is to write a replacement function and either
conditionally compile it, or put it into an appropriately-named file and
use <CODE>AC_REPLACE_FUNCS</CODE>.  For instance, Tcl uses
<CODE>AC_REPLACE_FUNCS(strstr)</CODE> to handle systems that have no
<CODE>strstr</CODE> function.
</P><P>

The second approach is used when there is a similar function with a
different name.  The idea here is to check for all the alternatives and
then modify your source to use whichever one might exist.  The idiom
here is to use <CODE>break</CODE> in the second argument to
<CODE>AC_CHECK_FUNCS</CODE>; this is used both to skip unnecessary tests and
to indicate to the reader that these checks are related.  For instance,
here is how <CODE>libgcj</CODE> checks for <CODE>inet_aton</CODE> or
<CODE>inet_addr</CODE>; it only uses the first one found:
</P><P>

<TABLE width=100%><tr><td>&nbsp;</td><td class=example bgcolor=#6688aa><br><pre>AC_CHECK_FUNCS(inet_aton inet_addr, break)
</pre></td></tr></table></P><P>

Code to use the results of these checks looks something like:
</P><P>

<TABLE width=100%><tr><td>&nbsp;</td><td class=example bgcolor=#6688aa><br><pre>#if HAVE_INET_ATON
  ... use inet_aton here
#else
#if HAVE_INET_ADDR
  ... use inet_addr here
#else
#error Function missing!
#endif
#endif
</pre></td></tr></table></P><P>

Note how we've made it a compile-time error if the function does not
exist.  In general it is best to make errors occur as early as possible
in the build process.
</P><P>

The third approach to non-portable functions is to write code such that
these functions are only optionally used.  For instance, if you are
writing an editor you might decide to use <CODE>mmap</CODE> to map a file into
the editor's memory.  However, since <CODE>mmap</CODE> is not portable, you
would also write a function to use the more portable <CODE>read</CODE>.
</P><P>

Handling known non-portable functions is only part of the problem,
however.  The pragmatic approach works fairly well, but it is somewhat
inefficient if you are primarily developing on a more modern system,
like GNU/Linux, which has few functions missing.  In this case the
problem is that you might not notice non-portable constructs in your
code until it has largely been finished.
</P><P>

Unfortunately, there's no high road to solving this problem.  In the
end, you need to have a working knowledge of the range of existing Unix
systems.  Knowledge of standards such as POSIX and XPG can be useful
here, as a first cut -- if it isn't in POSIX, you should at least
consider checking for it.  However, standards are not a panacea -- not
all systems are POSIX compliant, and sometimes there are bugs in systems
functions which you must work around.
</P><P>

One final class of problems you might encounter is that it is also easy
to check for too much.  This is bad because it adds unnecessary
maintenance burden to your program.  For instance, sometimes you'll see
code that checks for <CODE>&#60;sys/types.h&#62;</CODE>.  However, there's no point in
doing that -- using this header is mostly portable.  Again, this can
only be addressed by having a practical knowledge, which is only really
possible by examining your target systems.
</P><P>

<A NAME="Using Configuration Names"></A>
</TR></TABLE>
<BR>  
<FONT SIZE="-1">
This document was generated
by <I>Gary V. Vaughan</I> on <I>May, 24  2001</I>
using <A HREF="http://www.mathematik.uni-kl.de/~obachman/Texi2html
"><I>texi2html</I></A>

</BODY>
</HTML>
