<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>SPK Compiler API Documentation: main.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="classes.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<h1>main.cpp</h1><a href="main_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00142"></a>00142 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00143"></a>00143 <span class="preprocessor">#include &lt;fstream&gt;</span>
<a name="l00144"></a>00144 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00145"></a>00145 <span class="preprocessor">#include &lt;errno.h&gt;</span>
<a name="l00146"></a>00146 
<a name="l00147"></a>00147 <span class="preprocessor">#include &lt;sys/types.h&gt;</span>
<a name="l00148"></a>00148 <span class="preprocessor">#include &lt;sys/stat.h&gt;</span>
<a name="l00149"></a>00149 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
<a name="l00150"></a>00150 <span class="preprocessor">#include &lt;sys/time.h&gt;</span>
<a name="l00151"></a>00151 
<a name="l00152"></a>00152 <span class="preprocessor">#include "<a class="code" href="client_8h.html">client.h</a>"</span>
<a name="l00153"></a>00153 <span class="preprocessor">#include "<a class="code" href="SpkCompilerException_8h.html">SpkCompilerException.h</a>"</span>
<a name="l00154"></a>00154 <span class="preprocessor">#include "<a class="code" href="ClientTranslator_8h.html">ClientTranslator.h</a>"</span>
<a name="l00155"></a>00155 <span class="preprocessor">#include "<a class="code" href="NonmemTranslator_8h.html">nonmem/NonmemTranslator.h</a>"</span>
<a name="l00156"></a>00156 <span class="preprocessor">#include "<a class="code" href="DOMPrint_8h.html">DOMPrint.h</a>"</span>
<a name="l00157"></a>00157 
<a name="l00158"></a>00158 <span class="preprocessor">#include &lt;xercesc/util/XMLString.hpp&gt;</span>
<a name="l00159"></a>00159 <span class="preprocessor">#include &lt;xercesc/util/PlatformUtils.hpp&gt;</span>
<a name="l00160"></a>00160 <span class="preprocessor">#include &lt;xercesc/dom/DOM.hpp&gt;</span>
<a name="l00161"></a>00161 <span class="preprocessor">#include &lt;xercesc/parsers/XercesDOMParser.hpp&gt;</span>
<a name="l00162"></a>00162 
<a name="l00163"></a>00163 <span class="keyword">using namespace </span>std;
<a name="l00164"></a>00164 <span class="keyword">using namespace </span>xercesc;
<a name="l00165"></a>00165 
<a name="l00166"></a>00166 
<a name="l00167"></a>00167 <span class="keyword">namespace</span>{ 
<a name="l00168"></a>00168 
<a name="l00169"></a><a class="code" href="main_8cpp.html#b79734d452464b05699d10c9bc20ef07">00169</a>   <span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="main_8cpp.html#b79734d452464b05699d10c9bc20ef07">compilation_error_xml</a>[] = <span class="stringliteral">"compilation_error.xml"</span>;
<a name="l00170"></a>00170 
<a name="l00176"></a><a class="code" href="main_8cpp.html#01cc5a1d3d874f5f1f345c482bfcdfc5">00176</a>   <span class="keyword">enum</span> <a class="code" href="main_8cpp.html#01cc5a1d3d874f5f1f345c482bfcdfc5">EXIT_CODE</a> { <a class="code" href="main_8cpp.html#01cc5a1d3d874f5f1f345c482bfcdfc5cef3df326b5ee558dc8ed5433b15cd9f">SUCCESS</a>=0,       
<a name="l00177"></a>00177                    <a class="code" href="main_8cpp.html#01cc5a1d3d874f5f1f345c482bfcdfc56c8bf8efccd812e76e5863b8e804df50">XML_PARSE_ERR</a>=1, 
<a name="l00178"></a>00178            <a class="code" href="main_8cpp.html#01cc5a1d3d874f5f1f345c482bfcdfc51bb54ef49c0298d3e73832bd1ce6e99c">ACCESS_ERR</a>=2,    
<a name="l00179"></a><a class="code" href="main_8cpp.html#01cc5a1d3d874f5f1f345c482bfcdfc5c7a2174a6bec4a3fee54497a6ecc00f3">00179</a>            <a class="code" href="main_8cpp.html#01cc5a1d3d874f5f1f345c482bfcdfc5c7a2174a6bec4a3fee54497a6ecc00f3">OTHER_ERR</a>        
<a name="l00180"></a>00180                  };
<a name="l00181"></a>00181 };
<a name="l00190"></a><a class="code" href="main_8cpp.html#f80a16aad59770f233295334fcb0dc50">00190</a> <span class="keyword">static</span> <a class="code" href="namespaceclient.html#73c7036c7c431ff370684afc0408d4f4">client::type</a> <a class="code" href="main_8cpp.html#f80a16aad59770f233295334fcb0dc50">getClientName</a>( xercesc::DOMDocument* source )
<a name="l00191"></a>00191 {
<a name="l00192"></a>00192   DOMElement * root = source-&gt;getDocumentElement();
<a name="l00193"></a>00193   DOMTreeWalker * walker = source-&gt;createTreeWalker( root, 
<a name="l00194"></a>00194                              DOMNodeFilter::SHOW_ELEMENT, 
<a name="l00195"></a>00195                              NULL, 
<a name="l00196"></a>00196                              <span class="keyword">false</span> );
<a name="l00197"></a>00197   <span class="keyword">const</span> XMLCh * c = walker-&gt;firstChild()-&gt;getNodeName();
<a name="l00198"></a>00198     
<a name="l00199"></a>00199   <span class="keywordflow">if</span>( XMLString::equals( c, XMLString::transcode(<span class="stringliteral">"nonmem"</span>) ) )
<a name="l00200"></a>00200     <span class="keywordflow">return</span> <a class="code" href="namespaceclient.html#73c7036c7c431ff370684afc0408d4f4d800a82642069c3b621414e58bc19fc1">client::NONMEM</a>;
<a name="l00201"></a>00201   <span class="keywordflow">return</span> client::NOT_SUPPORTED;
<a name="l00202"></a>00202 }
<a name="l00203"></a>00203 
<a name="l00207"></a><a class="code" href="main_8cpp.html#e9f731015323f24ecbc16d0101e37845">00207</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="main_8cpp.html#e9f731015323f24ecbc16d0101e37845">genCompilationErrorML</a>( <span class="keyword">const</span> <a class="code" href="classSpkCompilerException.html">SpkCompilerException</a>&amp; e )
<a name="l00208"></a>00208 {
<a name="l00209"></a>00209   ofstream o( <a class="code" href="main_8cpp.html#b79734d452464b05699d10c9bc20ef07">compilation_error_xml</a> );
<a name="l00210"></a>00210   <span class="keywordflow">if</span>( !o.good() )
<a name="l00211"></a>00211     {
<a name="l00212"></a>00212       cerr &lt;&lt; <span class="stringliteral">"Failed to create "</span> &lt;&lt; <a class="code" href="main_8cpp.html#b79734d452464b05699d10c9bc20ef07">compilation_error_xml</a> &lt;&lt; <span class="stringliteral">"."</span> &lt;&lt; endl;
<a name="l00213"></a>00213       cerr &lt;&lt; <span class="stringliteral">"Abnormal termination..."</span> &lt;&lt; endl;
<a name="l00214"></a>00214       abort();
<a name="l00215"></a>00215     }
<a name="l00216"></a>00216   o &lt;&lt; <span class="stringliteral">"&lt;?xml version=\"1.0\"?&gt;"</span> &lt;&lt; endl;
<a name="l00217"></a>00217   o &lt;&lt; <span class="stringliteral">"&lt;spkreport&gt;"</span> &lt;&lt; endl;
<a name="l00218"></a>00218   o &lt;&lt; e.<a class="code" href="classSpkCompilerException.html#9e48c02aea997fdff99f0c191e6695c0">getXml</a>() &lt;&lt; endl;
<a name="l00219"></a>00219   o &lt;&lt; <span class="stringliteral">"&lt;/spkreport&gt;"</span> &lt;&lt; endl;
<a name="l00220"></a>00220   o.close();
<a name="l00221"></a>00221   <span class="keywordflow">return</span>;
<a name="l00222"></a>00222 }
<a name="l00229"></a><a class="code" href="main_8cpp.html#4e3e1bcc0b77836ba2f089e6ac6d0172">00229</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="main_8cpp.html#4e3e1bcc0b77836ba2f089e6ac6d0172">usage</a>( <span class="keywordtype">char</span>* o )
<a name="l00230"></a>00230 {
<a name="l00231"></a>00231   strcpy( o, <span class="stringliteral">"\n\n"</span> );
<a name="l00232"></a>00232   strcat( o, <span class="stringliteral">"Usage: spkcompiler SOURCE DATA\n"</span> );
<a name="l00233"></a>00233   strcat( o, <span class="stringliteral">"\n"</span> );
<a name="l00234"></a>00234   strcat( o, <span class="stringliteral">"   SOURCE    --- file path to an SpkSourceML document\n"</span> );
<a name="l00235"></a>00235   strcat( o ,<span class="stringliteral">"   DATA      --- file path to an SpkDataML document\n"</span> );
<a name="l00236"></a>00236   strcat( o, <span class="stringliteral">"\n"</span> );
<a name="l00237"></a>00237   strcat( o, <span class="stringliteral">"&lt;Exit Code&gt;\n"</span> );
<a name="l00238"></a>00238   strcat( o, <span class="stringliteral">"   0: The compilation completed successfully.\n"</span> );
<a name="l00239"></a>00239   strcat( o, <span class="stringliteral">"      A makefile, \"Makefile.SPK\", along with the source\n"</span> );
<a name="l00240"></a>00240   strcat( o, <span class="stringliteral">"      code files are generated in the current directory.\n"</span> );
<a name="l00241"></a>00241   strcat( o, <span class="stringliteral">"   1: Syntax errors are found in either/both SOURCE or/and DATA.\n"</span> );
<a name="l00242"></a>00242   strcat( o, <span class="stringliteral">"      compilation_error.xml will be generated in the current directory.\n"</span> );
<a name="l00243"></a>00243   strcat( o, <span class="stringliteral">"   2: File/directory access denied.\n"</span> );
<a name="l00244"></a>00244   strcat( o, <span class="stringliteral">"   x: Any other error is reported with an unspecified exit code greater than 2.\n"</span> );
<a name="l00245"></a>00245   strcat( o, <span class="stringliteral">"      compilation_error.xml will generated in the current directory.\n"</span> );
<a name="l00246"></a>00246     
<a name="l00247"></a>00247   <span class="keywordflow">return</span>;
<a name="l00248"></a>00248 }
<a name="l00249"></a>00249 
<a name="l00250"></a>00250 <span class="comment">/* rename -- rename a file</span>
<a name="l00251"></a>00251 <span class="comment">int rename (const char * old, const char * new)</span>
<a name="l00252"></a>00252 <span class="comment"></span>
<a name="l00253"></a>00253 <span class="comment">Renames a file from old to new.  If new already</span>
<a name="l00254"></a>00254 <span class="comment">exists, it is removed.</span>
<a name="l00255"></a>00255 <span class="comment"></span>
<a name="l00256"></a>00256 <span class="comment">*/</span>
<a name="l00257"></a><a class="code" href="main_8cpp.html#2f6cd98da9cd5374b6f8ca5db171c6d6">00257</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="main_8cpp.html#2f6cd98da9cd5374b6f8ca5db171c6d6">rename</a> (<span class="keywordtype">char</span>* zfrom, <span class="keywordtype">char</span>* zto)
<a name="l00258"></a>00258 {
<a name="l00259"></a>00259   <span class="keywordflow">if</span> (link (zfrom, zto) &lt; 0)
<a name="l00260"></a>00260     {
<a name="l00261"></a>00261       <span class="keywordflow">if</span> (errno != EEXIST)
<a name="l00262"></a>00262     <span class="keywordflow">return</span> -1;
<a name="l00263"></a>00263       <span class="keywordflow">if</span> (unlink (zto) &lt; 0
<a name="l00264"></a>00264       || link (zfrom, zto) &lt; 0)
<a name="l00265"></a>00265     <span class="keywordflow">return</span> -1;
<a name="l00266"></a>00266     }
<a name="l00267"></a>00267   <span class="keywordflow">return</span> unlink (zfrom);
<a name="l00268"></a>00268 }
<a name="l00269"></a>00269 
<a name="l00288"></a><a class="code" href="main_8cpp.html#c7b16fbe17de077e14ae88e9d45a3663">00288</a> <span class="keywordtype">int</span> <a class="code" href="main_8cpp.html#c7b16fbe17de077e14ae88e9d45a3663">main</a>( <span class="keywordtype">int</span> argc, <span class="keyword">const</span> <span class="keywordtype">char</span>* argv[] )
<a name="l00289"></a>00289 {
<a name="l00290"></a>00290   <span class="keywordflow">if</span> (argc &lt; 3)
<a name="l00291"></a>00291   {
<a name="l00292"></a>00292     <span class="keywordtype">char</span> error_message[ <a class="code" href="classSpkCompilerError.html#e122376e543be6c83edef715c92599e1">SpkCompilerError::maxMessageLen</a>() ];
<a name="l00293"></a>00293     <a class="code" href="main_8cpp.html#4e3e1bcc0b77836ba2f089e6ac6d0172">usage</a>( error_message );
<a name="l00294"></a>00294     cerr &lt;&lt; error_message &lt;&lt; endl;
<a name="l00295"></a>00295     <a class="code" href="classSpkCompilerException.html">SpkCompilerException</a> e( <a class="code" href="classSpkCompilerError.html#2743acfc3b04803a497c786509f4935daff632dac54a3e48a2c0c7130a02f937">SpkCompilerError::ASPK_PROGRAMMER_ERR</a>, 
<a name="l00296"></a>00296                                <span class="stringliteral">"Missing command line arguments: spkcompiler SOURCE DATA"</span>, 
<a name="l00297"></a>00297                                __LINE__, __FILE__ );
<a name="l00298"></a>00298     <a class="code" href="main_8cpp.html#e9f731015323f24ecbc16d0101e37845">genCompilationErrorML</a>( e );
<a name="l00299"></a>00299     
<a name="l00300"></a>00300     <span class="keywordflow">return</span> <a class="code" href="main_8cpp.html#01cc5a1d3d874f5f1f345c482bfcdfc5c7a2174a6bec4a3fee54497a6ecc00f3">OTHER_ERR</a>;
<a name="l00301"></a>00301   }  
<a name="l00302"></a>00302   <span class="keyword">const</span> <span class="keywordtype">char</span> * gSource = argv[1];
<a name="l00303"></a>00303   <span class="keyword">const</span> <span class="keywordtype">char</span> * gData   = argv[2];
<a name="l00304"></a>00304 
<a name="l00305"></a>00305   <span class="keywordflow">try</span>
<a name="l00306"></a>00306     {
<a name="l00307"></a>00307       XMLPlatformUtils::Initialize();
<a name="l00308"></a>00308     }
<a name="l00309"></a>00309   <span class="keywordflow">catch</span>( <span class="keyword">const</span> XMLException &amp; toCatch )
<a name="l00310"></a>00310     {
<a name="l00311"></a>00311       <span class="keywordtype">char</span> error_message[ <a class="code" href="classSpkCompilerError.html#e122376e543be6c83edef715c92599e1">SpkCompilerError::maxMessageLen</a>() ];
<a name="l00312"></a>00312       snprintf( error_message, 
<a name="l00313"></a>00313         <a class="code" href="classSpkCompilerError.html#e122376e543be6c83edef715c92599e1">SpkCompilerError::maxMessageLen</a>(),
<a name="l00314"></a>00314         <span class="stringliteral">"Error during Xerces-c Initialization.\nException message: %s.\n"</span>,
<a name="l00315"></a>00315       XMLString::transcode( toCatch.getMessage() ) );
<a name="l00316"></a>00316       <a class="code" href="classSpkCompilerException.html">SpkCompilerException</a> e( <a class="code" href="classSpkCompilerError.html#2743acfc3b04803a497c786509f4935d517eaebb6f81f8c0af7e9db6d2fc2a2e">SpkCompilerError::ASPK_XMLDOM_ERR</a>, 
<a name="l00317"></a>00317                                  error_message, 
<a name="l00318"></a>00318                                  __LINE__, __FILE__ );
<a name="l00319"></a>00319       <a class="code" href="main_8cpp.html#e9f731015323f24ecbc16d0101e37845">genCompilationErrorML</a>( e );
<a name="l00320"></a>00320       <span class="keywordflow">return</span> <a class="code" href="main_8cpp.html#01cc5a1d3d874f5f1f345c482bfcdfc5c7a2174a6bec4a3fee54497a6ecc00f3">OTHER_ERR</a>;
<a name="l00321"></a>00321     }
<a name="l00322"></a>00322 
<a name="l00323"></a>00323   <span class="comment">//</span>
<a name="l00324"></a>00324   <span class="comment">// A pointer to the SpkSourceML document.</span>
<a name="l00325"></a>00325   <span class="comment">//</span>
<a name="l00326"></a>00326   xercesc::DOMDocument * source;
<a name="l00327"></a>00327 
<a name="l00328"></a>00328   <span class="comment">//</span>
<a name="l00329"></a>00329   <span class="comment">// A pointer to the SpkDataML document.</span>
<a name="l00330"></a>00330   <span class="comment">//</span>
<a name="l00331"></a>00331   xercesc::DOMDocument * data;
<a name="l00332"></a>00332 
<a name="l00333"></a>00333   <span class="comment">//</span>
<a name="l00334"></a>00334   <span class="comment">// Initializes the XML DOM parser.</span>
<a name="l00335"></a>00335   <span class="comment">//</span>
<a name="l00336"></a>00336   xercesc::XercesDOMParser *parser = <span class="keyword">new</span> xercesc::XercesDOMParser;
<a name="l00337"></a>00337   parser-&gt;setValidationScheme( XercesDOMParser::Val_Auto );
<a name="l00338"></a>00338   parser-&gt;setDoNamespaces( <span class="keyword">true</span> );
<a name="l00339"></a>00339   parser-&gt;setDoSchema( <span class="keyword">true</span> );
<a name="l00340"></a>00340   parser-&gt;setValidationSchemaFullChecking( <span class="keyword">true</span> );
<a name="l00341"></a>00341   parser-&gt;setCreateEntityReferenceNodes( <span class="keyword">true</span> );
<a name="l00342"></a>00342 
<a name="l00343"></a>00343   <span class="comment">//</span>
<a name="l00344"></a>00344   <span class="comment">// Parsing the SpkSourceML document.</span>
<a name="l00345"></a>00345   <span class="comment">//</span>
<a name="l00346"></a>00346   <span class="keywordflow">try</span>
<a name="l00347"></a>00347   {
<a name="l00348"></a>00348     ifstream iSource( gSource );
<a name="l00349"></a>00349     <span class="keywordflow">if</span>( !iSource.good() )
<a name="l00350"></a>00350       {
<a name="l00351"></a>00351         XMLPlatformUtils::Terminate();
<a name="l00352"></a>00352         <span class="keywordtype">char</span> error_message[ <a class="code" href="classSpkCompilerError.html#e122376e543be6c83edef715c92599e1">SpkCompilerError::maxMessageLen</a>() ];
<a name="l00353"></a>00353         snprintf( error_message, 
<a name="l00354"></a>00354           <a class="code" href="classSpkCompilerError.html#e122376e543be6c83edef715c92599e1">SpkCompilerError::maxMessageLen</a>(),
<a name="l00355"></a>00355           <span class="stringliteral">"Failed to open %s!\n"</span>, gSource );
<a name="l00356"></a>00356     <a class="code" href="classSpkCompilerException.html">SpkCompilerException</a> e( <a class="code" href="classSpkCompilerError.html#2743acfc3b04803a497c786509f4935dc112b437339e8d6a33908996ae2381d6">SpkCompilerError::ASPK_STD_ERR</a>, 
<a name="l00357"></a>00357                                    error_message, 
<a name="l00358"></a>00358                                    __LINE__, __FILE__ );
<a name="l00359"></a>00359         <a class="code" href="main_8cpp.html#e9f731015323f24ecbc16d0101e37845">genCompilationErrorML</a>( e );
<a name="l00360"></a>00360         <span class="keywordflow">return</span> <a class="code" href="main_8cpp.html#01cc5a1d3d874f5f1f345c482bfcdfc51bb54ef49c0298d3e73832bd1ce6e99c">ACCESS_ERR</a>;
<a name="l00361"></a>00361       }
<a name="l00362"></a>00362     iSource.close();
<a name="l00363"></a>00363     parser-&gt;parse( gSource );
<a name="l00364"></a>00364     source = parser-&gt;getDocument();
<a name="l00365"></a>00365   }
<a name="l00366"></a>00366   <span class="keywordflow">catch</span>( <span class="keyword">const</span> XMLException&amp; e )
<a name="l00367"></a>00367   {
<a name="l00368"></a>00368     XMLPlatformUtils::Terminate();
<a name="l00369"></a>00369     <span class="keywordtype">char</span> error_message[ <a class="code" href="classSpkCompilerError.html#e122376e543be6c83edef715c92599e1">SpkCompilerError::maxMessageLen</a>() ];
<a name="l00370"></a>00370     snprintf( error_message, 
<a name="l00371"></a>00371           <a class="code" href="classSpkCompilerError.html#e122376e543be6c83edef715c92599e1">SpkCompilerError::maxMessageLen</a>(),
<a name="l00372"></a>00372           <span class="stringliteral">"An error occurred during parsing\n   Message: %s\n"</span>, 
<a name="l00373"></a>00373           XMLString::transcode(e.getMessage() ) );
<a name="l00374"></a>00374     <a class="code" href="classSpkCompilerException.html">SpkCompilerException</a> e( <a class="code" href="classSpkCompilerError.html#2743acfc3b04803a497c786509f4935d517eaebb6f81f8c0af7e9db6d2fc2a2e">SpkCompilerError::ASPK_XMLDOM_ERR</a>, 
<a name="l00375"></a>00375                                error_message, 
<a name="l00376"></a>00376                                __LINE__, __FILE__ );
<a name="l00377"></a>00377     <a class="code" href="main_8cpp.html#e9f731015323f24ecbc16d0101e37845">genCompilationErrorML</a>( e );
<a name="l00378"></a>00378     <span class="keywordflow">return</span> <a class="code" href="main_8cpp.html#01cc5a1d3d874f5f1f345c482bfcdfc56c8bf8efccd812e76e5863b8e804df50">XML_PARSE_ERR</a>;
<a name="l00379"></a>00379   }
<a name="l00380"></a>00380   <span class="keywordflow">catch</span>( <span class="keyword">const</span> DOMException&amp; e )
<a name="l00381"></a>00381   {
<a name="l00382"></a>00382       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> maxChars = <a class="code" href="classSpkCompilerError.html#e122376e543be6c83edef715c92599e1">SpkCompilerError::maxMessageLen</a>()-20;
<a name="l00383"></a>00383       XMLCh errText[maxChars + 1];
<a name="l00384"></a>00384       fprintf( stderr, <span class="stringliteral">"DOM Error during parsing \"%s\".\nDOMException code is: %d\n"</span>,
<a name="l00385"></a>00385                gSource, e.code );
<a name="l00386"></a>00386       
<a name="l00387"></a>00387       <span class="keywordflow">if</span> (DOMImplementation::loadDOMExceptionMsg(e.code, errText, maxChars))
<a name="l00388"></a>00388       {
<a name="l00389"></a>00389         XMLPlatformUtils::Terminate();
<a name="l00390"></a>00390         <span class="keywordtype">char</span> error_message[ <a class="code" href="classSpkCompilerError.html#e122376e543be6c83edef715c92599e1">SpkCompilerError::maxMessageLen</a>() ];    
<a name="l00391"></a>00391         snprintf( error_message, 
<a name="l00392"></a>00392           <a class="code" href="classSpkCompilerError.html#e122376e543be6c83edef715c92599e1">SpkCompilerError::maxMessageLen</a>(),
<a name="l00393"></a>00393           <span class="stringliteral">"Message is: %s.\n"</span>, 
<a name="l00394"></a>00394           XMLString::transcode(errText) );
<a name="l00395"></a>00395     <a class="code" href="classSpkCompilerException.html">SpkCompilerException</a> e( <a class="code" href="classSpkCompilerError.html#2743acfc3b04803a497c786509f4935d517eaebb6f81f8c0af7e9db6d2fc2a2e">SpkCompilerError::ASPK_XMLDOM_ERR</a>, 
<a name="l00396"></a>00396                                    error_message, 
<a name="l00397"></a>00397                                    __LINE__, __FILE__ );
<a name="l00398"></a>00398         <a class="code" href="main_8cpp.html#e9f731015323f24ecbc16d0101e37845">genCompilationErrorML</a>( e );
<a name="l00399"></a>00399         <span class="keywordflow">return</span> <a class="code" href="main_8cpp.html#01cc5a1d3d874f5f1f345c482bfcdfc56c8bf8efccd812e76e5863b8e804df50">XML_PARSE_ERR</a>;
<a name="l00400"></a>00400       }
<a name="l00401"></a>00401   }
<a name="l00402"></a>00402   <span class="keywordflow">catch</span>( ... )
<a name="l00403"></a>00403   {
<a name="l00404"></a>00404     XMLPlatformUtils::Terminate();
<a name="l00405"></a>00405     <span class="keywordtype">char</span> error_message[ <a class="code" href="classSpkCompilerError.html#e122376e543be6c83edef715c92599e1">SpkCompilerError::maxMessageLen</a>() ];
<a name="l00406"></a>00406     snprintf( error_message, 
<a name="l00407"></a>00407           <a class="code" href="classSpkCompilerError.html#e122376e543be6c83edef715c92599e1">SpkCompilerError::maxMessageLen</a>(),
<a name="l00408"></a>00408           <span class="stringliteral">"An unknown error occurred during parsing.\n %d, %s\n"</span> );
<a name="l00409"></a>00409     <a class="code" href="classSpkCompilerException.html">SpkCompilerException</a> e( <a class="code" href="classSpkCompilerError.html#2743acfc3b04803a497c786509f4935d517eaebb6f81f8c0af7e9db6d2fc2a2e">SpkCompilerError::ASPK_XMLDOM_ERR</a>, 
<a name="l00410"></a>00410                                error_message, 
<a name="l00411"></a>00411                                __LINE__, __FILE__ );
<a name="l00412"></a>00412     <a class="code" href="main_8cpp.html#e9f731015323f24ecbc16d0101e37845">genCompilationErrorML</a>( e );
<a name="l00413"></a>00413     <span class="keywordflow">return</span> <a class="code" href="main_8cpp.html#01cc5a1d3d874f5f1f345c482bfcdfc56c8bf8efccd812e76e5863b8e804df50">XML_PARSE_ERR</a>;
<a name="l00414"></a>00414   }
<a name="l00415"></a>00415 
<a name="l00416"></a>00416   <span class="comment">//</span>
<a name="l00417"></a>00417   <span class="comment">// Parsing the SpkDataML document.</span>
<a name="l00418"></a>00418   <span class="comment">//</span>
<a name="l00419"></a>00419   <span class="keywordflow">try</span>{
<a name="l00420"></a>00420     ifstream iData( gData );
<a name="l00421"></a>00421     <span class="keywordflow">if</span>( !iData.good() )
<a name="l00422"></a>00422     {
<a name="l00423"></a>00423        XMLPlatformUtils::Terminate();
<a name="l00424"></a>00424        <span class="keywordtype">char</span> error_message[ <a class="code" href="classSpkCompilerError.html#e122376e543be6c83edef715c92599e1">SpkCompilerError::maxMessageLen</a>() ];
<a name="l00425"></a>00425        snprintf( error_message, 
<a name="l00426"></a>00426          <a class="code" href="classSpkCompilerError.html#e122376e543be6c83edef715c92599e1">SpkCompilerError::maxMessageLen</a>(),
<a name="l00427"></a>00427          <span class="stringliteral">"Failed to open %s!\n"</span>, gData );
<a name="l00428"></a>00428        <a class="code" href="classSpkCompilerException.html">SpkCompilerException</a> e( <a class="code" href="classSpkCompilerError.html#2743acfc3b04803a497c786509f4935dc112b437339e8d6a33908996ae2381d6">SpkCompilerError::ASPK_STD_ERR</a>, 
<a name="l00429"></a>00429                                   error_message, 
<a name="l00430"></a>00430                                   __LINE__, __FILE__ );
<a name="l00431"></a>00431        <a class="code" href="main_8cpp.html#e9f731015323f24ecbc16d0101e37845">genCompilationErrorML</a>( e );
<a name="l00432"></a>00432        <span class="keywordflow">return</span> <a class="code" href="main_8cpp.html#01cc5a1d3d874f5f1f345c482bfcdfc51bb54ef49c0298d3e73832bd1ce6e99c">ACCESS_ERR</a>;
<a name="l00433"></a>00433     }
<a name="l00434"></a>00434     parser-&gt;parse( gData );
<a name="l00435"></a>00435     data = parser-&gt;getDocument();
<a name="l00436"></a>00436   }
<a name="l00437"></a>00437   <span class="keywordflow">catch</span>( <span class="keyword">const</span> XMLException&amp; e )
<a name="l00438"></a>00438   {
<a name="l00439"></a>00439     XMLPlatformUtils::Terminate();
<a name="l00440"></a>00440     <span class="keywordtype">char</span> error_message[ <a class="code" href="classSpkCompilerError.html#e122376e543be6c83edef715c92599e1">SpkCompilerError::maxMessageLen</a>() ];
<a name="l00441"></a>00441     snprintf( error_message, 
<a name="l00442"></a>00442           <a class="code" href="classSpkCompilerError.html#e122376e543be6c83edef715c92599e1">SpkCompilerError::maxMessageLen</a>(),
<a name="l00443"></a>00443           <span class="stringliteral">"An error occurred during parsing\n   Message: %s\n"</span>, 
<a name="l00444"></a>00444           XMLString::transcode(e.getMessage() ) );
<a name="l00445"></a>00445     <a class="code" href="classSpkCompilerException.html">SpkCompilerException</a> e( <a class="code" href="classSpkCompilerError.html#2743acfc3b04803a497c786509f4935d517eaebb6f81f8c0af7e9db6d2fc2a2e">SpkCompilerError::ASPK_XMLDOM_ERR</a>, 
<a name="l00446"></a>00446                                error_message, 
<a name="l00447"></a>00447                                __LINE__, __FILE__ );
<a name="l00448"></a>00448     <a class="code" href="main_8cpp.html#e9f731015323f24ecbc16d0101e37845">genCompilationErrorML</a>( e );
<a name="l00449"></a>00449     <span class="keywordflow">return</span> <a class="code" href="main_8cpp.html#01cc5a1d3d874f5f1f345c482bfcdfc56c8bf8efccd812e76e5863b8e804df50">XML_PARSE_ERR</a>;
<a name="l00450"></a>00450   }
<a name="l00451"></a>00451   <span class="keywordflow">catch</span>( <span class="keyword">const</span> DOMException&amp; e )
<a name="l00452"></a>00452   {
<a name="l00453"></a>00453       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> maxChars = 2047;
<a name="l00454"></a>00454       XMLCh errText[maxChars + 1];
<a name="l00455"></a>00455       <span class="keywordtype">char</span> error_message[ <a class="code" href="classSpkCompilerError.html#e122376e543be6c83edef715c92599e1">SpkCompilerError::maxMessageLen</a>() ];
<a name="l00456"></a>00456       
<a name="l00457"></a>00457       <span class="keywordflow">if</span> (DOMImplementation::loadDOMExceptionMsg(e.code, errText, maxChars))
<a name="l00458"></a>00458       {
<a name="l00459"></a>00459         XMLPlatformUtils::Terminate();
<a name="l00460"></a>00460         snprintf( error_message,
<a name="l00461"></a>00461           <a class="code" href="classSpkCompilerError.html#e122376e543be6c83edef715c92599e1">SpkCompilerError::maxMessageLen</a>(),
<a name="l00462"></a>00462                  <span class="stringliteral">"DOM Error during parsing \"%s\".\nDOMException code is: %d\n \</span>
<a name="l00463"></a>00463 <span class="stringliteral">                  Message is: %s.\n"</span>, XMLString::transcode(errText),
<a name="l00464"></a>00464                  gData, e.code );
<a name="l00465"></a>00465     <a class="code" href="classSpkCompilerException.html">SpkCompilerException</a> e( <a class="code" href="classSpkCompilerError.html#2743acfc3b04803a497c786509f4935d517eaebb6f81f8c0af7e9db6d2fc2a2e">SpkCompilerError::ASPK_XMLDOM_ERR</a>, 
<a name="l00466"></a>00466                                    error_message, 
<a name="l00467"></a>00467                                    __LINE__, __FILE__ );
<a name="l00468"></a>00468         <a class="code" href="main_8cpp.html#e9f731015323f24ecbc16d0101e37845">genCompilationErrorML</a>( e );
<a name="l00469"></a>00469       }
<a name="l00470"></a>00470       <span class="keywordflow">else</span>
<a name="l00471"></a>00471       {
<a name="l00472"></a>00472         snprintf( error_message, 
<a name="l00473"></a>00473           <a class="code" href="classSpkCompilerError.html#e122376e543be6c83edef715c92599e1">SpkCompilerError::maxMessageLen</a>(),
<a name="l00474"></a>00474           <span class="stringliteral">"DOM Error during parsing \"%s\".\nDOMException code is: %d\n"</span>,
<a name="l00475"></a>00475                  gData, e.code );
<a name="l00476"></a>00476     <a class="code" href="classSpkCompilerException.html">SpkCompilerException</a> e( <a class="code" href="classSpkCompilerError.html#2743acfc3b04803a497c786509f4935d517eaebb6f81f8c0af7e9db6d2fc2a2e">SpkCompilerError::ASPK_XMLDOM_ERR</a>, 
<a name="l00477"></a>00477                                    error_message, 
<a name="l00478"></a>00478                                    __LINE__, __FILE__ );
<a name="l00479"></a>00479       }
<a name="l00480"></a>00480       <span class="keywordflow">return</span> <a class="code" href="main_8cpp.html#01cc5a1d3d874f5f1f345c482bfcdfc56c8bf8efccd812e76e5863b8e804df50">XML_PARSE_ERR</a>;
<a name="l00481"></a>00481   }
<a name="l00482"></a>00482   <span class="keywordflow">catch</span>( ... )
<a name="l00483"></a>00483   {
<a name="l00484"></a>00484     XMLPlatformUtils::Terminate();
<a name="l00485"></a>00485     <span class="keywordtype">char</span> error_message[ <a class="code" href="classSpkCompilerError.html#e122376e543be6c83edef715c92599e1">SpkCompilerError::maxMessageLen</a>() ];
<a name="l00486"></a>00486     snprintf( error_message, 
<a name="l00487"></a>00487           <a class="code" href="classSpkCompilerError.html#e122376e543be6c83edef715c92599e1">SpkCompilerError::maxMessageLen</a>(),
<a name="l00488"></a>00488           <span class="stringliteral">"An unknown error occurred during parsing %s.\n"</span>, gData );
<a name="l00489"></a>00489     <a class="code" href="classSpkCompilerException.html">SpkCompilerException</a> e( <a class="code" href="classSpkCompilerError.html#2743acfc3b04803a497c786509f4935d517eaebb6f81f8c0af7e9db6d2fc2a2e">SpkCompilerError::ASPK_XMLDOM_ERR</a>, 
<a name="l00490"></a>00490                             error_message, __LINE__, __FILE__ );
<a name="l00491"></a>00491     <a class="code" href="main_8cpp.html#e9f731015323f24ecbc16d0101e37845">genCompilationErrorML</a>( e ); 
<a name="l00492"></a>00492     <span class="keywordflow">return</span> <a class="code" href="main_8cpp.html#01cc5a1d3d874f5f1f345c482bfcdfc56c8bf8efccd812e76e5863b8e804df50">XML_PARSE_ERR</a>;
<a name="l00493"></a>00493   }
<a name="l00494"></a>00494                                                                                 
<a name="l00495"></a>00495   <a class="code" href="namespaceclient.html#73c7036c7c431ff370684afc0408d4f4">client::type</a> cl = <a class="code" href="main_8cpp.html#f80a16aad59770f233295334fcb0dc50">getClientName</a>( source );
<a name="l00496"></a>00496   <span class="keywordflow">if</span>( cl == client::NOT_SUPPORTED )
<a name="l00497"></a>00497     {
<a name="l00498"></a>00498       XMLPlatformUtils::Terminate();
<a name="l00499"></a>00499       <span class="keywordtype">char</span> error_message[ <a class="code" href="classSpkCompilerError.html#e122376e543be6c83edef715c92599e1">SpkCompilerError::maxMessageLen</a>() ];
<a name="l00500"></a>00500       snprintf( error_message,
<a name="l00501"></a>00501         <a class="code" href="classSpkCompilerError.html#e122376e543be6c83edef715c92599e1">SpkCompilerError::maxMessageLen</a>(),
<a name="l00502"></a>00502         <span class="stringliteral">"Not a supported client!"</span> );
<a name="l00503"></a>00503       cerr &lt;&lt; error_message &lt;&lt; endl;
<a name="l00504"></a>00504       <a class="code" href="classSpkCompilerException.html">SpkCompilerException</a> e( <a class="code" href="classSpkCompilerError.html#2743acfc3b04803a497c786509f4935dbf7918d9e64556832eca4c5d3aa904da">SpkCompilerError::ASPK_SOURCEML_ERR</a>, 
<a name="l00505"></a>00505                                  error_message, 
<a name="l00506"></a>00506                                  __LINE__, __FILE__ );
<a name="l00507"></a>00507       <a class="code" href="main_8cpp.html#e9f731015323f24ecbc16d0101e37845">genCompilationErrorML</a>( e );
<a name="l00508"></a>00508       <span class="keywordflow">return</span> <a class="code" href="main_8cpp.html#01cc5a1d3d874f5f1f345c482bfcdfc5c7a2174a6bec4a3fee54497a6ecc00f3">OTHER_ERR</a>;
<a name="l00509"></a>00509     }
<a name="l00510"></a>00510 
<a name="l00511"></a>00511   <span class="comment">// Call/construct an appropriate translator.</span>
<a name="l00512"></a>00512 
<a name="l00513"></a>00513   <a class="code" href="classClientTranslator.html">ClientTranslator</a> *xlator = NULL;
<a name="l00514"></a>00514 
<a name="l00515"></a>00515   <span class="keywordflow">if</span>( cl == <a class="code" href="namespaceclient.html#73c7036c7c431ff370684afc0408d4f4d800a82642069c3b621414e58bc19fc1">client::NONMEM</a> )
<a name="l00516"></a>00516     xlator = <span class="keyword">new</span> <a class="code" href="classNonmemTranslator.html">NonmemTranslator</a>( source, data );
<a name="l00517"></a>00517 
<a name="l00518"></a>00518   <span class="keywordflow">try</span>{
<a name="l00519"></a>00519     xlator-&gt;<a class="code" href="classClientTranslator.html#49a30884e0e651c3af305b6cfbb8f5a3">translate</a>();
<a name="l00520"></a>00520   }
<a name="l00521"></a>00521   <span class="keywordflow">catch</span>( <span class="keyword">const</span> <a class="code" href="classSpkCompilerException.html">SpkCompilerException</a>&amp; e )
<a name="l00522"></a>00522   {
<a name="l00523"></a>00523     XMLPlatformUtils::Terminate();
<a name="l00524"></a>00524     <a class="code" href="main_8cpp.html#e9f731015323f24ecbc16d0101e37845">genCompilationErrorML</a>( e );
<a name="l00525"></a>00525     <span class="keywordflow">return</span> <a class="code" href="main_8cpp.html#01cc5a1d3d874f5f1f345c482bfcdfc56c8bf8efccd812e76e5863b8e804df50">XML_PARSE_ERR</a>;
<a name="l00526"></a>00526   }
<a name="l00527"></a>00527   <span class="keywordflow">catch</span>( ... )
<a name="l00528"></a>00528   {
<a name="l00529"></a>00529     XMLPlatformUtils::Terminate();
<a name="l00530"></a>00530     <span class="keywordtype">char</span> error_message[ <a class="code" href="classSpkCompilerError.html#e122376e543be6c83edef715c92599e1">SpkCompilerError::maxMessageLen</a>() ];
<a name="l00531"></a>00531     snprintf( error_message, 
<a name="l00532"></a>00532           <a class="code" href="classSpkCompilerError.html#e122376e543be6c83edef715c92599e1">SpkCompilerError::maxMessageLen</a>(),
<a name="l00533"></a>00533           <span class="stringliteral">"An unknown error occurred during compilation.\n %d, %s\n"</span> );
<a name="l00534"></a>00534     <a class="code" href="classSpkCompilerException.html">SpkCompilerException</a> e( <a class="code" href="classSpkCompilerError.html#2743acfc3b04803a497c786509f4935dbf7918d9e64556832eca4c5d3aa904da">SpkCompilerError::ASPK_SOURCEML_ERR</a>, 
<a name="l00535"></a>00535                                error_message, __LINE__, __FILE__ );
<a name="l00536"></a>00536     <a class="code" href="main_8cpp.html#e9f731015323f24ecbc16d0101e37845">genCompilationErrorML</a>( e );
<a name="l00537"></a>00537     <span class="keywordflow">return</span> <a class="code" href="main_8cpp.html#01cc5a1d3d874f5f1f345c482bfcdfc56c8bf8efccd812e76e5863b8e804df50">XML_PARSE_ERR</a>;
<a name="l00538"></a>00538   }
<a name="l00539"></a>00539 
<a name="l00540"></a>00540   <span class="keyword">delete</span> xlator;
<a name="l00541"></a>00541 
<a name="l00542"></a>00542   cout &lt;&lt; <span class="stringliteral">"Completed succssfully."</span> &lt;&lt; endl;
<a name="l00543"></a>00543   <span class="keywordflow">return</span> <a class="code" href="main_8cpp.html#01cc5a1d3d874f5f1f345c482bfcdfc5cef3df326b5ee558dc8ed5433b15cd9f">SUCCESS</a>;
<a name="l00544"></a>00544 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue May 20 15:28:22 2008 for SPK Compiler API Documentation by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
