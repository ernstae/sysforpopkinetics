<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>SPK Compiler API Documentation: NM_parseAdvan.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="classes.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<h1>NM_parseAdvan.cpp</h1><a href="NM__parseAdvan_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00005"></a>00005 <span class="preprocessor">#include &lt;fstream&gt;</span>
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 <span class="preprocessor">#include "<a class="code" href="NonmemTranslator_8h.html">NonmemTranslator.h</a>"</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include "<a class="code" href="SpkCompilerException_8h.html">SpkCompilerException.h</a>"</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include "explang.h"</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include "<a class="code" href="countStrInLhs_8h.html">countStrInLhs.h</a>"</span>
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 <span class="preprocessor">#include &lt;xercesc/dom/DOMDocument.hpp&gt;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &lt;xercesc/dom/DOM.hpp&gt;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &lt;xercesc/util/XMLString.hpp&gt;</span>
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 <span class="keyword">using namespace </span>std;
<a name="l00017"></a>00017 <span class="keyword">using namespace </span>xercesc;
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 <span class="comment">//****************************************************************</span>
<a name="l00022"></a>00022 <span class="comment">// Following NONMEM specification, parse modules in the</span>
<a name="l00023"></a>00023 <span class="comment">// order of:</span>
<a name="l00024"></a>00024 <span class="comment">//    1. COMP_MODEL ($MODEL)</span>
<a name="l00025"></a>00025 <span class="comment">//    1. PK         ($PK)</span>
<a name="l00026"></a>00026 <span class="comment">//    2. DIFFEQN    ($DES)</span>
<a name="l00027"></a>00027 <span class="comment">//    3. ERROR      ($ERROR)</span>
<a name="l00028"></a>00028 <span class="comment">//****************************************************************</span>
<a name="l00029"></a>00029 <span class="keywordtype">void</span> <a class="code" href="classNonmemTranslator.html#0aaeae239e3b33280b52f2f40b44f10c">NonmemTranslator::parseAdvan</a>(
<a name="l00030"></a>00030                   <span class="keyword">enum</span> MODEL_SPEC   advan,
<a name="l00031"></a>00031                   <span class="keyword">enum</span> TRANS        trans,
<a name="l00032"></a>00032                   <span class="keyword">const</span> DOMElement* model )
<a name="l00033"></a>00033 {
<a name="l00034"></a>00034   <span class="keywordflow">if</span>( advan != <a class="code" href="classNonmemTranslator.html#6f7b7f9526426cd62cee1682e008681e9492ad42106f73e0820022928fb899e9">ADVAN6</a> )
<a name="l00035"></a>00035     {
<a name="l00036"></a>00036       <span class="keywordtype">char</span> m[ <a class="code" href="classSpkCompilerError.html#e122376e543be6c83edef715c92599e1">SpkCompilerError::maxMessageLen</a>() ];
<a name="l00037"></a>00037       snprintf( m, 
<a name="l00038"></a>00038         <a class="code" href="classSpkCompilerError.html#e122376e543be6c83edef715c92599e1">SpkCompilerError::maxMessageLen</a>(),
<a name="l00039"></a>00039         <span class="stringliteral">"ADVAN%d is not supported!"</span>, (<span class="keywordtype">int</span>)advan );
<a name="l00040"></a>00040       <span class="keywordflow">throw</span> <a class="code" href="classSpkCompilerException.html">SpkCompilerException</a>( <a class="code" href="classSpkCompilerError.html#2743acfc3b04803a497c786509f4935d4e4b1ec6c464e05ae32a4d749471492e">SpkCompilerError::ASPK_USER_ERR</a>, m, __LINE__, __FILE__ );
<a name="l00041"></a>00041     }
<a name="l00042"></a>00042 
<a name="l00043"></a>00043   DOMNodeList * comp_models = model-&gt;getElementsByTagName( <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#d178852abe30bdf73aa7d2b5f4a94a6f">X_COMP_MODEL</a> );
<a name="l00044"></a>00044   DOMNodeList * pks         = model-&gt;getElementsByTagName( <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#6d267ebfba133094573433fea9d70af8">X_PK</a> );
<a name="l00045"></a>00045   DOMNodeList * errors      = model-&gt;getElementsByTagName( <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#4246bb23a536107c61cb2735b58ba72c">X_ERROR</a> );
<a name="l00046"></a>00046   DOMNodeList * diffeqns    = model-&gt;getElementsByTagName( <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#eec27313ab68dc0f7262408240de98fa">X_DIFFEQN</a> );
<a name="l00047"></a>00047   DOMElement  * comp_model  = NULL;
<a name="l00048"></a>00048   DOMElement  * diffeqn     = NULL;
<a name="l00049"></a>00049   DOMElement  * pk          = NULL;
<a name="l00050"></a>00050   DOMElement  * error       = NULL;
<a name="l00051"></a>00051 
<a name="l00052"></a>00052   <span class="comment">//</span>
<a name="l00053"></a>00053   <span class="comment">// Get &lt;pk&gt; and &lt;error&gt; are needed for any ADVAN.</span>
<a name="l00054"></a>00054   <span class="comment">//</span>
<a name="l00055"></a>00055   <span class="comment">// REVISIT Sachiko 05/12/2005</span>
<a name="l00056"></a>00056   <span class="comment">// There are times when $PK is not specified.  </span>
<a name="l00057"></a>00057   <span class="comment">// That's when the LINK is spefied for each compartment in $MODEL.</span>
<a name="l00058"></a>00058   <span class="comment">// For now, let's ignore that style of specification and</span>
<a name="l00059"></a>00059   <span class="comment">// mandate $PK.</span>
<a name="l00060"></a>00060   <span class="comment">//</span>
<a name="l00061"></a>00061   <span class="keywordflow">if</span>( pks-&gt;getLength() &lt; 1 || errors-&gt;getLength() &lt; 1 )
<a name="l00062"></a>00062     {
<a name="l00063"></a>00063       <span class="keywordtype">char</span> mess[ <a class="code" href="classSpkCompilerError.html#e122376e543be6c83edef715c92599e1">SpkCompilerError::maxMessageLen</a>() ];
<a name="l00064"></a>00064       snprintf( mess, 
<a name="l00065"></a>00065         SpkCompilerError::maxMessageLen(),
<a name="l00066"></a>00066         <span class="stringliteral">"Missing &lt;pk&gt; and/or &lt;error&gt;!"</span> );
<a name="l00067"></a>00067       <a class="code" href="classSpkCompilerException.html">SpkCompilerException</a> e( <a class="code" href="classSpkCompilerError.html#2743acfc3b04803a497c786509f4935dbf7918d9e64556832eca4c5d3aa904da">SpkCompilerError::ASPK_SOURCEML_ERR</a>,
<a name="l00068"></a>00068                   mess, __LINE__, __FILE__ );
<a name="l00069"></a>00069       <span class="keywordflow">throw</span> e;
<a name="l00070"></a>00070     }
<a name="l00071"></a>00071   
<a name="l00072"></a>00072   pk      = dynamic_cast&lt;DOMElement*&gt;( pks-&gt;item(0) );
<a name="l00073"></a>00073   <span class="keywordflow">if</span>( !pk )
<a name="l00074"></a>00074     {
<a name="l00075"></a>00075       <span class="keywordtype">char</span> m[ <a class="code" href="classSpkCompilerError.html#e122376e543be6c83edef715c92599e1">SpkCompilerError::maxMessageLen</a>() ];
<a name="l00076"></a>00076       snprintf( m, 
<a name="l00077"></a>00077         SpkCompilerError::maxMessageLen(),
<a name="l00078"></a>00078         <span class="stringliteral">"&lt;%s&gt; block is missing!"</span>, <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#58f376372b58255e04135a0f7a9361cc">C_PK</a> );
<a name="l00079"></a>00079       <span class="keywordflow">throw</span> <a class="code" href="classSpkCompilerException.html">SpkCompilerException</a>( <a class="code" href="classSpkCompilerError.html#2743acfc3b04803a497c786509f4935dbf7918d9e64556832eca4c5d3aa904da">SpkCompilerError::ASPK_SOURCEML_ERR</a>,
<a name="l00080"></a>00080                   m, __LINE__, __FILE__ );
<a name="l00081"></a>00081     }
<a name="l00082"></a>00082   error   = dynamic_cast&lt;DOMElement*&gt;( errors-&gt;item(0) );
<a name="l00083"></a>00083   <span class="keywordflow">if</span>( !error )
<a name="l00084"></a>00084     {
<a name="l00085"></a>00085       <span class="keywordtype">char</span> m[ <a class="code" href="classSpkCompilerError.html#e122376e543be6c83edef715c92599e1">SpkCompilerError::maxMessageLen</a>() ];
<a name="l00086"></a>00086       snprintf( m, 
<a name="l00087"></a>00087         SpkCompilerError::maxMessageLen(),
<a name="l00088"></a>00088         <span class="stringliteral">"&lt;%s&gt; block is missing!"</span>, <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#90f3ce2581e806e98f6eb41244f83b8a">C_ERROR</a> );
<a name="l00089"></a>00089       <span class="keywordflow">throw</span> <a class="code" href="classSpkCompilerException.html">SpkCompilerException</a>( <a class="code" href="classSpkCompilerError.html#2743acfc3b04803a497c786509f4935dbf7918d9e64556832eca4c5d3aa904da">SpkCompilerError::ASPK_SOURCEML_ERR</a>,
<a name="l00090"></a>00090                   m, __LINE__, __FILE__ );
<a name="l00091"></a>00091     }
<a name="l00092"></a>00092   
<a name="l00093"></a>00093   <span class="comment">// ADVAN 5-9 needs an additional model, the compartmental model definition &lt;comp_model&gt;.</span>
<a name="l00094"></a>00094   <span class="keywordflow">if</span>( advan &gt;= <a class="code" href="classNonmemTranslator.html#6f7b7f9526426cd62cee1682e008681e43f54c024f889399ce16b1527c86292a">ADVAN5</a> &amp;&amp; advan &lt;= <a class="code" href="classNonmemTranslator.html#6f7b7f9526426cd62cee1682e008681e64c83d6ce8c08ea865cecee32699aa5c">ADVAN9</a> )
<a name="l00095"></a>00095     {
<a name="l00096"></a>00096       <span class="keywordflow">if</span>( comp_models-&gt;getLength() &lt; 1 )
<a name="l00097"></a>00097     {
<a name="l00098"></a>00098       <span class="keywordtype">char</span> mess[ SpkCompilerError::maxMessageLen() ];
<a name="l00099"></a>00099       snprintf( mess, 
<a name="l00100"></a>00100             SpkCompilerError::maxMessageLen(),
<a name="l00101"></a>00101             <span class="stringliteral">"&lt;comp_model&gt; must be specified when ADVAN 5-9 is used!"</span> );
<a name="l00102"></a>00102       <a class="code" href="classSpkCompilerException.html">SpkCompilerException</a> e( <a class="code" href="classSpkCompilerError.html#2743acfc3b04803a497c786509f4935dbf7918d9e64556832eca4c5d3aa904da">SpkCompilerError::ASPK_SOURCEML_ERR</a>,
<a name="l00103"></a>00103                   mess, __LINE__, __FILE__ );
<a name="l00104"></a>00104       <span class="keywordflow">throw</span> e;
<a name="l00105"></a>00105     }
<a name="l00106"></a>00106       comp_model = dynamic_cast&lt;DOMElement*&gt;( comp_models-&gt;item(0) );
<a name="l00107"></a>00107 
<a name="l00108"></a>00108       <span class="comment">// further, ADVAN 6, 8 and 9 needs the differential equations, &lt;diffeqn&gt;.</span>
<a name="l00109"></a>00109       <span class="keywordflow">if</span>( advan == 6 || advan == 8 || advan == 9 )
<a name="l00110"></a>00110     {
<a name="l00111"></a>00111       <span class="keywordflow">if</span>( diffeqns-&gt;getLength() &lt; 1 )
<a name="l00112"></a>00112         {
<a name="l00113"></a>00113           <span class="keywordtype">char</span> mess[ SpkCompilerError::maxMessageLen() ];
<a name="l00114"></a>00114           snprintf( mess, 
<a name="l00115"></a>00115             SpkCompilerError::maxMessageLen(),
<a name="l00116"></a>00116             <span class="stringliteral">"&lt;diffeqn&gt; must be specified when ADVAN 6, 8 or 9 is used!"</span> );
<a name="l00117"></a>00117           <a class="code" href="classSpkCompilerException.html">SpkCompilerException</a> e( <a class="code" href="classSpkCompilerError.html#2743acfc3b04803a497c786509f4935dbf7918d9e64556832eca4c5d3aa904da">SpkCompilerError::ASPK_SOURCEML_ERR</a>,
<a name="l00118"></a>00118                       mess, __LINE__, __FILE__ );
<a name="l00119"></a>00119           <span class="keywordflow">throw</span> e;
<a name="l00120"></a>00120         }
<a name="l00121"></a>00121       diffeqn = dynamic_cast&lt;DOMElement*&gt;( diffeqns-&gt;item(0) );
<a name="l00122"></a>00122     }
<a name="l00123"></a>00123     }
<a name="l00124"></a>00124 
<a name="l00125"></a>00125   <span class="comment">//assert( table-&gt;find( nonmem::EVID ) );</span>
<a name="l00126"></a>00126   assert( <a class="code" href="classNonmemTranslator.html#7cdb34ced820cc22c242e85e710aa076">table</a>-&gt;<a class="code" href="classSymbolTable.html#6b681d2875323db888e53065ed87ca5c">find</a>( <a class="code" href="namespacenonmem.html#7ad9360c37d1486cf1307c15dfb6f392">nonmem::AMT</a> ) );
<a name="l00127"></a>00127   assert( <a class="code" href="classNonmemTranslator.html#7cdb34ced820cc22c242e85e710aa076">table</a>-&gt;<a class="code" href="classSymbolTable.html#6b681d2875323db888e53065ed87ca5c">find</a>( <a class="code" href="namespacenonmem.html#f0b83e9dcbe61fd2379d3dc4131ff741">nonmem::TIME</a> ) );
<a name="l00128"></a>00128   <span class="comment">//assert( table-&gt;find( nonmem::"RATE" ) );       // optional</span>
<a name="l00129"></a>00129   <span class="comment">//assert( table-&gt;find( nonmem::CMT ) );  // optional</span>
<a name="l00130"></a>00130   <span class="comment">//assert( table-&gt;find( nonmem::PCMT ) ); // optional</span>
<a name="l00131"></a>00131 
<a name="l00132"></a>00132   <span class="comment">// These may/should appear on the left hand side of assignment in the user's equations.</span>
<a name="l00133"></a>00133   <span class="comment">// In that case, the variable would be registered to the symbol table</span>
<a name="l00134"></a>00134   <span class="comment">// as a user variable automatically.  But, we want it to be a system</span>
<a name="l00135"></a>00135   <span class="comment">// variable and also read-write.  So, we register in the way</span>
<a name="l00136"></a>00136   <span class="comment">// we require in advance.</span>
<a name="l00137"></a>00137   <a class="code" href="classNonmemTranslator.html#7cdb34ced820cc22c242e85e710aa076">table</a>-&gt;<a class="code" href="classSymbolTable.html#8a596527945c2d2c29c14cc387f3826c">insertScalar</a>( <a class="code" href="namespacenonmem.html#b62e768802606d60f93ca02d22539a2d">nonmem::F</a>, <a class="code" href="classSymbol.html#a962f23fa9d44a5cca685745dd09df60147d6d21f166d10086910fbe42821a38">Symbol::SYSTEM</a>, <a class="code" href="classSymbol.html#8bdf0fab3d4db200bb23e9f12e0f75b2690e5a7d03f333b1dec0b9a6d23b3126">Symbol::READWRITE</a> );
<a name="l00138"></a>00138   <a class="code" href="classNonmemTranslator.html#7cdb34ced820cc22c242e85e710aa076">table</a>-&gt;<a class="code" href="classSymbolTable.html#8a596527945c2d2c29c14cc387f3826c">insertScalar</a>( <a class="code" href="namespacenonmem.html#17332ad734534c1a68985bc591281740">nonmem::Y</a>, <a class="code" href="classSymbol.html#a962f23fa9d44a5cca685745dd09df60147d6d21f166d10086910fbe42821a38">Symbol::SYSTEM</a>, <a class="code" href="classSymbol.html#8bdf0fab3d4db200bb23e9f12e0f75b2690e5a7d03f333b1dec0b9a6d23b3126">Symbol::READWRITE</a> );
<a name="l00139"></a>00139  
<a name="l00140"></a>00140   <span class="keywordtype">double</span> relTol;
<a name="l00141"></a>00141   <span class="keywordflow">if</span>( advan == 6 || advan == 8 || advan == 9 )
<a name="l00142"></a>00142     {
<a name="l00143"></a>00143       <span class="keywordtype">unsigned</span> sig_digits = 0;
<a name="l00144"></a>00144       <span class="keywordflow">if</span>( model-&gt;hasAttribute( <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#b55cab28c64124d4a16b0a61e30a96e1">X_TOLERANCE</a> ) )
<a name="l00145"></a>00145     {
<a name="l00146"></a>00146       <span class="keyword">const</span> XMLCh *x_tol = model-&gt;getAttribute( <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#b55cab28c64124d4a16b0a61e30a96e1">X_TOLERANCE</a> );
<a name="l00147"></a>00147       <span class="keywordflow">if</span>( !XMLString::textToBin( x_tol, sig_digits ) )
<a name="l00148"></a>00148         {
<a name="l00149"></a>00149           <span class="keywordtype">char</span> m[ <a class="code" href="classSpkCompilerError.html#e122376e543be6c83edef715c92599e1">SpkCompilerError::maxMessageLen</a>() ];
<a name="l00150"></a>00150           snprintf( m, 
<a name="l00151"></a>00151             SpkCompilerError::maxMessageLen(),
<a name="l00152"></a>00152             <span class="stringliteral">"Invalid %s: %s"</span>, <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#10068dc975bf34b6da1a2cd5a80ea864">C_TOLERANCE</a>, XMLString::transcode( x_tol ) );
<a name="l00153"></a>00153           <span class="keywordflow">throw</span> <a class="code" href="classSpkCompilerException.html">SpkCompilerException</a>( <a class="code" href="classSpkCompilerError.html#2743acfc3b04803a497c786509f4935d4e4b1ec6c464e05ae32a4d749471492e">SpkCompilerError::ASPK_USER_ERR</a>, m, __LINE__, __FILE__ );
<a name="l00154"></a>00154         }
<a name="l00155"></a>00155       relTol = pow( 10.0, -(sig_digits+1.0) );
<a name="l00156"></a>00156     }
<a name="l00157"></a>00157 
<a name="l00158"></a>00158       <a class="code" href="classNonmemTranslator.html#fd7ea52bbb1ee4acd9b9eb41ceae8aad">parseCompModel</a>( comp_model, relTol );
<a name="l00159"></a>00159       assert( <a class="code" href="classNonmemTranslator.html#f619a2db9666bbe079a036af27c6fe5f">myCompModel</a> != NULL );
<a name="l00160"></a>00160       
<a name="l00161"></a>00161       <span class="comment">// P(n), A(m) and DADT(m) may appear on the left hand side of</span>
<a name="l00162"></a>00162       <span class="comment">// assignment statements in model equations. </span>
<a name="l00163"></a>00163       <span class="comment">// n = NPARAMETERS (assumed so for now), m = NCOMPARTMENTS+1.</span>
<a name="l00164"></a>00164       <span class="comment">// Currently our expression compiler cannot figure out</span>
<a name="l00165"></a>00165       <span class="comment">// the size of a vector as it parses through.</span>
<a name="l00166"></a>00166       <span class="comment">// So, provide the vectors before hand. </span>
<a name="l00167"></a>00167       <span class="comment">//  </span>
<a name="l00168"></a>00168       <a class="code" href="classNonmemTranslator.html#7cdb34ced820cc22c242e85e710aa076">table</a>-&gt;<a class="code" href="classSymbolTable.html#92df3611182c5f15c3527a2cdf32026d">insertVector</a>( <a class="code" href="namespacenonmem.html#8d8a18780250fe2eee7149832898c10f">nonmem::P</a>,    <a class="code" href="classNonmemTranslator.html#f619a2db9666bbe079a036af27c6fe5f">myCompModel</a>-&gt;<a class="code" href="classCompModelInfo.html#ba1f93ddfda2ca0de17e525936a6b1e5">getNParameters</a>(),   <a class="code" href="classSymbol.html#a962f23fa9d44a5cca685745dd09df60147d6d21f166d10086910fbe42821a38">Symbol::SYSTEM</a>, <a class="code" href="classSymbol.html#8bdf0fab3d4db200bb23e9f12e0f75b2690e5a7d03f333b1dec0b9a6d23b3126">Symbol::READWRITE</a> );
<a name="l00169"></a>00169       <a class="code" href="classNonmemTranslator.html#7cdb34ced820cc22c242e85e710aa076">table</a>-&gt;<a class="code" href="classSymbolTable.html#92df3611182c5f15c3527a2cdf32026d">insertVector</a>( <a class="code" href="namespacenonmem.html#f50e87d87f3f6c8fc97d5941d81ee4c0">nonmem::DADT</a>, <a class="code" href="classNonmemTranslator.html#f619a2db9666bbe079a036af27c6fe5f">myCompModel</a>-&gt;<a class="code" href="classCompModelInfo.html#cdcfd540d1532d88dbf1e093e3d29acd">getNCompartments</a>(), <a class="code" href="classSymbol.html#a962f23fa9d44a5cca685745dd09df60147d6d21f166d10086910fbe42821a38">Symbol::SYSTEM</a>, <a class="code" href="classSymbol.html#8bdf0fab3d4db200bb23e9f12e0f75b2690e5a7d03f333b1dec0b9a6d23b3126">Symbol::READWRITE</a> );
<a name="l00170"></a>00170       <a class="code" href="classNonmemTranslator.html#7cdb34ced820cc22c242e85e710aa076">table</a>-&gt;<a class="code" href="classSymbolTable.html#92df3611182c5f15c3527a2cdf32026d">insertVector</a>( <a class="code" href="namespacenonmem.html#533b7e1c6a5ddebdcd1ee99ccd9b6024">nonmem::A</a>,    <a class="code" href="classNonmemTranslator.html#f619a2db9666bbe079a036af27c6fe5f">myCompModel</a>-&gt;<a class="code" href="classCompModelInfo.html#cdcfd540d1532d88dbf1e093e3d29acd">getNCompartments</a>(), <a class="code" href="classSymbol.html#a962f23fa9d44a5cca685745dd09df60147d6d21f166d10086910fbe42821a38">Symbol::SYSTEM</a>, <a class="code" href="classSymbol.html#8bdf0fab3d4db200bb23e9f12e0f75b2d888661233e59fedbdeda31e9cb62bb8">Symbol::READONLY</a> );
<a name="l00171"></a>00171 
<a name="l00172"></a>00172       <span class="comment">// REVISIT - Sachiko 08/09/2005</span>
<a name="l00173"></a>00173       <span class="comment">// For ODE models (ADVAN 6, 8 and 9),</span>
<a name="l00174"></a>00174       <span class="comment">// T (the continuous time) is required.</span>
<a name="l00175"></a>00175       <span class="comment">// The values is set by the ODE solver.</span>
<a name="l00176"></a>00176       <a class="code" href="classNonmemTranslator.html#7cdb34ced820cc22c242e85e710aa076">table</a>-&gt;<a class="code" href="classSymbolTable.html#8a596527945c2d2c29c14cc387f3826c">insertScalar</a>( <a class="code" href="namespacenonmem.html#be6d48b5459e3257bcbe3d9590907547">nonmem::T</a>,      <a class="code" href="classSymbol.html#a962f23fa9d44a5cca685745dd09df60147d6d21f166d10086910fbe42821a38">Symbol::SYSTEM</a>, <a class="code" href="classSymbol.html#8bdf0fab3d4db200bb23e9f12e0f75b2d888661233e59fedbdeda31e9cb62bb8">Symbol::READONLY</a> );
<a name="l00177"></a>00177       <a class="code" href="classNonmemTranslator.html#7cdb34ced820cc22c242e85e710aa076">table</a>-&gt;<a class="code" href="classSymbolTable.html#8a596527945c2d2c29c14cc387f3826c">insertScalar</a>( <a class="code" href="namespacenonmem.html#9898f218bf85bffc368a1aa85245dfbf">nonmem::TSCALE</a>, <a class="code" href="classSymbol.html#a962f23fa9d44a5cca685745dd09df60147d6d21f166d10086910fbe42821a38">Symbol::SYSTEM</a>, <a class="code" href="classSymbol.html#8bdf0fab3d4db200bb23e9f12e0f75b2690e5a7d03f333b1dec0b9a6d23b3126">Symbol::READWRITE</a> );
<a name="l00178"></a>00178       <a class="code" href="classNonmemTranslator.html#7cdb34ced820cc22c242e85e710aa076">table</a>-&gt;<a class="code" href="classSymbolTable.html#8a596527945c2d2c29c14cc387f3826c">insertScalar</a>( <a class="code" href="namespacenonmem.html#ed2ebcd9db66037333c20c63865da571">nonmem::FO</a>,     <a class="code" href="classSymbol.html#a962f23fa9d44a5cca685745dd09df60147d6d21f166d10086910fbe42821a38">Symbol::SYSTEM</a>, <a class="code" href="classSymbol.html#8bdf0fab3d4db200bb23e9f12e0f75b2690e5a7d03f333b1dec0b9a6d23b3126">Symbol::READWRITE</a> ); <span class="comment">// ef-oh</span>
<a name="l00179"></a>00179       <a class="code" href="classNonmemTranslator.html#7cdb34ced820cc22c242e85e710aa076">table</a>-&gt;<a class="code" href="classSymbolTable.html#8a596527945c2d2c29c14cc387f3826c">insertScalar</a>( <a class="code" href="namespacenonmem.html#a99a010cbad207a054802451b228e42c">nonmem::F0</a>,     <a class="code" href="classSymbol.html#a962f23fa9d44a5cca685745dd09df60147d6d21f166d10086910fbe42821a38">Symbol::SYSTEM</a>, <a class="code" href="classSymbol.html#8bdf0fab3d4db200bb23e9f12e0f75b2690e5a7d03f333b1dec0b9a6d23b3126">Symbol::READWRITE</a> ); <span class="comment">// ef-zero</span>
<a name="l00180"></a>00180       <a class="code" href="classNonmemTranslator.html#7cdb34ced820cc22c242e85e710aa076">table</a>-&gt;<a class="code" href="classSymbolTable.html#8a596527945c2d2c29c14cc387f3826c">insertScalar</a>( <a class="code" href="namespacenonmem.html#fe8109853f358628ad0a491222abc1cc">nonmem::S0</a>,     <a class="code" href="classSymbol.html#a962f23fa9d44a5cca685745dd09df60147d6d21f166d10086910fbe42821a38">Symbol::SYSTEM</a>, <a class="code" href="classSymbol.html#8bdf0fab3d4db200bb23e9f12e0f75b2690e5a7d03f333b1dec0b9a6d23b3126">Symbol::READWRITE</a> ); <span class="comment">// es-zero</span>
<a name="l00181"></a>00181       <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classNonmemTranslator.html#f619a2db9666bbe079a036af27c6fe5f">myCompModel</a>-&gt;<a class="code" href="classCompModelInfo.html#cdcfd540d1532d88dbf1e093e3d29acd">getNCompartments</a>(); i++ )
<a name="l00182"></a>00182     {
<a name="l00183"></a>00183       <span class="keywordtype">char</span> tmp_s[ 32 ], tmp_f[ 32 ], tmp_r[ 32 ], tmp_d[ 32 ], tmp_alag[ 32 ];
<a name="l00184"></a>00184       snprintf( tmp_r,    
<a name="l00185"></a>00185             SpkCompilerError::maxMessageLen(),
<a name="l00186"></a>00186             <span class="stringliteral">"%s%d"</span>, <a class="code" href="namespacenonmem.html#d5c729781709fab2f1c5fe7c0feea014">nonmem::R</a>.c_str(), i+1 );    <span class="comment">// infusion rate for i-th comp</span>
<a name="l00187"></a>00187       snprintf( tmp_d,    
<a name="l00188"></a>00188             SpkCompilerError::maxMessageLen(),
<a name="l00189"></a>00189             <span class="stringliteral">"%s%d"</span>, <a class="code" href="namespacenonmem.html#e4970ab4cb65d5ef8d275c99d251d51c">nonmem::D</a>.c_str(), i+1 );    <span class="comment">// infusion duration for i-th comp</span>
<a name="l00190"></a>00190       snprintf( tmp_alag, 
<a name="l00191"></a>00191             SpkCompilerError::maxMessageLen(),
<a name="l00192"></a>00192             <span class="stringliteral">"%s%d"</span>, <a class="code" href="namespacenonmem.html#ae1690db3a90ea62d395f24b93fb6c83">nonmem::ALAG</a>.c_str(), i+1 ); <span class="comment">// absorption lag time for i-th comp</span>
<a name="l00193"></a>00193       snprintf( tmp_s,    
<a name="l00194"></a>00194             SpkCompilerError::maxMessageLen(),
<a name="l00195"></a>00195             <span class="stringliteral">"%s%d"</span>, <a class="code" href="namespacenonmem.html#45da8ea7d60cadf5acaeb8aecaf25930">nonmem::S</a>.c_str(), i+1 );    <span class="comment">// scale for i-th comp</span>
<a name="l00196"></a>00196       snprintf( tmp_f,    
<a name="l00197"></a>00197             SpkCompilerError::maxMessageLen(),
<a name="l00198"></a>00198             <span class="stringliteral">"%s%d"</span>, nonmem::F.c_str(), i+1 ); 
<a name="l00199"></a>00199 
<a name="l00200"></a>00200       <a class="code" href="classNonmemTranslator.html#7cdb34ced820cc22c242e85e710aa076">table</a>-&gt;<a class="code" href="classSymbolTable.html#8a596527945c2d2c29c14cc387f3826c">insertScalar</a>( tmp_r,    <a class="code" href="classSymbol.html#a962f23fa9d44a5cca685745dd09df60147d6d21f166d10086910fbe42821a38">Symbol::SYSTEM</a>, <a class="code" href="classSymbol.html#8bdf0fab3d4db200bb23e9f12e0f75b2690e5a7d03f333b1dec0b9a6d23b3126">Symbol::READWRITE</a> );
<a name="l00201"></a>00201       <a class="code" href="classNonmemTranslator.html#7cdb34ced820cc22c242e85e710aa076">table</a>-&gt;<a class="code" href="classSymbolTable.html#8a596527945c2d2c29c14cc387f3826c">insertScalar</a>( tmp_d,    <a class="code" href="classSymbol.html#a962f23fa9d44a5cca685745dd09df60147d6d21f166d10086910fbe42821a38">Symbol::SYSTEM</a>, <a class="code" href="classSymbol.html#8bdf0fab3d4db200bb23e9f12e0f75b2690e5a7d03f333b1dec0b9a6d23b3126">Symbol::READWRITE</a> ); 
<a name="l00202"></a>00202       <a class="code" href="classNonmemTranslator.html#7cdb34ced820cc22c242e85e710aa076">table</a>-&gt;<a class="code" href="classSymbolTable.html#8a596527945c2d2c29c14cc387f3826c">insertScalar</a>( tmp_alag, <a class="code" href="classSymbol.html#a962f23fa9d44a5cca685745dd09df60147d6d21f166d10086910fbe42821a38">Symbol::SYSTEM</a>, <a class="code" href="classSymbol.html#8bdf0fab3d4db200bb23e9f12e0f75b2690e5a7d03f333b1dec0b9a6d23b3126">Symbol::READWRITE</a> ); 
<a name="l00203"></a>00203       <a class="code" href="classNonmemTranslator.html#7cdb34ced820cc22c242e85e710aa076">table</a>-&gt;<a class="code" href="classSymbolTable.html#8a596527945c2d2c29c14cc387f3826c">insertScalar</a>( tmp_s,    <a class="code" href="classSymbol.html#a962f23fa9d44a5cca685745dd09df60147d6d21f166d10086910fbe42821a38">Symbol::SYSTEM</a>, <a class="code" href="classSymbol.html#8bdf0fab3d4db200bb23e9f12e0f75b2690e5a7d03f333b1dec0b9a6d23b3126">Symbol::READWRITE</a> );
<a name="l00204"></a>00204       <a class="code" href="classNonmemTranslator.html#7cdb34ced820cc22c242e85e710aa076">table</a>-&gt;<a class="code" href="classSymbolTable.html#8a596527945c2d2c29c14cc387f3826c">insertScalar</a>( tmp_f,    <a class="code" href="classSymbol.html#a962f23fa9d44a5cca685745dd09df60147d6d21f166d10086910fbe42821a38">Symbol::SYSTEM</a>, <a class="code" href="classSymbol.html#8bdf0fab3d4db200bb23e9f12e0f75b2690e5a7d03f333b1dec0b9a6d23b3126">Symbol::READWRITE</a> ); 
<a name="l00205"></a>00205     }
<a name="l00206"></a>00206 
<a name="l00207"></a>00207       <a class="code" href="classNonmemTranslator.html#bcac497ec004de569a7ced660f2c16df">parsePK</a>( pk );
<a name="l00208"></a>00208       <a class="code" href="classNonmemTranslator.html#73350b7a1b144fed8551546754db4e0f">parseDiffEqn</a>( diffeqn );
<a name="l00209"></a>00209       <a class="code" href="classNonmemTranslator.html#3b890b9f5e9ca6221bdde45128afafad">parseError</a>( error );
<a name="l00210"></a>00210 
<a name="l00211"></a>00211     }
<a name="l00212"></a>00212 }
<a name="l00213"></a>00213 <span class="comment">//</span>
<a name="l00214"></a>00214 <span class="comment">// Parse &lt;comp_model&gt; which defines a compartmental model.</span>
<a name="l00215"></a>00215 <span class="comment">// #of compartments, #of equilibrim compartments, #of basic PK parameters</span>
<a name="l00216"></a>00216 <span class="comment">// are determined.  For each compartment, a number of attributes will be</span>
<a name="l00217"></a>00217 <span class="comment">// determined.</span>
<a name="l00218"></a>00218 <span class="comment">// The return value is the number of compartments defined by the user</span>
<a name="l00219"></a>00219 <span class="comment">// plus the output compartment.</span>
<a name="l00220"></a>00220 <span class="comment">// </span>
<a name="l00221"></a>00221 <span class="comment">// Post-condition:</span>
<a name="l00222"></a>00222 <span class="comment">// myCompModel-&gt;getNCompartments() &gt; 0</span>
<a name="l00223"></a>00223 <span class="comment">// myCompModel-&gt;getNEquilibrim() &gt;= 0</span>
<a name="l00224"></a>00224 <span class="comment">// myCompModel-&gt;getNParameters() &gt;= 0</span>
<a name="l00225"></a>00225 <span class="comment">//</span>
<a name="l00226"></a>00226 <span class="comment">// For each compartment, </span>
<a name="l00227"></a>00227 <span class="comment">// </span>
<a name="l00228"></a>00228 <span class="keywordtype">int</span> <a class="code" href="classNonmemTranslator.html#fd7ea52bbb1ee4acd9b9eb41ceae8aad">NonmemTranslator::parseCompModel</a>( <span class="keyword">const</span> DOMElement* comp_model, <span class="keywordtype">double</span> relTol )
<a name="l00229"></a>00229 {
<a name="l00230"></a>00230   <span class="keyword">const</span> DOMNodeList * compartment_list = comp_model-&gt;getElementsByTagName( <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#e83be1c465fc3c2436ed49d13a6ac56c">X_COMPARTMENT</a> ); 
<a name="l00231"></a>00231 
<a name="l00232"></a>00232   <span class="comment">// #of compartments other than the ouput compartment.</span>
<a name="l00233"></a>00233   <span class="comment">// This value must match the number of &lt;compartment&gt; sub-entries.</span>
<a name="l00234"></a>00234   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nUserCompartments; <span class="comment">/* User specified #of compartments (this doesn't include the output comp)*/</span>
<a name="l00235"></a>00235   <span class="keywordflow">if</span>( comp_model-&gt;hasAttribute( <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#0ccc5244bfd176486d876db127f835ad">X_NCOMPARTMENTS</a> ) )
<a name="l00236"></a>00236     {
<a name="l00237"></a>00237       <span class="keyword">const</span> XMLCh* x_ncompartments = comp_model-&gt;getAttribute( <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#0ccc5244bfd176486d876db127f835ad">X_NCOMPARTMENTS</a> );
<a name="l00238"></a>00238       <span class="keywordflow">if</span>( ! XMLString::textToBin( x_ncompartments, nUserCompartments ) )
<a name="l00239"></a>00239     {
<a name="l00240"></a>00240           <span class="keywordtype">char</span> mess[ <a class="code" href="classSpkCompilerError.html#e122376e543be6c83edef715c92599e1">SpkCompilerError::maxMessageLen</a>() ];
<a name="l00241"></a>00241           snprintf( mess,
<a name="l00242"></a>00242             SpkCompilerError::maxMessageLen(),
<a name="l00243"></a>00243             <span class="stringliteral">"Invalid &lt;%s::%s&gt; attribute value: \"%s\""</span>, <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#0e9855a6ea7370809e66a72a064920a2">C_COMP_MODEL</a>, <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#9d8ea8f0278ca4d0ef451f92b3942c8e">C_NCOMPARTMENTS</a>,
<a name="l00244"></a>00244             XMLString::transcode(x_ncompartments) );
<a name="l00245"></a>00245           <a class="code" href="classSpkCompilerException.html">SpkCompilerException</a> e( <a class="code" href="classSpkCompilerError.html#2743acfc3b04803a497c786509f4935d4e4b1ec6c464e05ae32a4d749471492e">SpkCompilerError::ASPK_USER_ERR</a>, mess, __LINE__, __FILE__);
<a name="l00246"></a>00246           <span class="keywordflow">throw</span> e;
<a name="l00247"></a>00247     } 
<a name="l00248"></a>00248       <span class="keywordflow">if</span>( nUserCompartments != compartment_list-&gt;getLength() )
<a name="l00249"></a>00249     {
<a name="l00250"></a>00250           <span class="keywordtype">char</span> mess[ SpkCompilerError::maxMessageLen() ];
<a name="l00251"></a>00251           snprintf( mess,
<a name="l00252"></a>00252             SpkCompilerError::maxMessageLen(),
<a name="l00253"></a>00253             <span class="stringliteral">"The number of compartments specified in &lt;%s::%s&gt; does not match with the number of &lt;%s&gt; incidents!"</span>,
<a name="l00254"></a>00254             <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#0e9855a6ea7370809e66a72a064920a2">C_COMP_MODEL</a>, <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#9d8ea8f0278ca4d0ef451f92b3942c8e">C_NCOMPARTMENTS</a>, <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#c06fb4f106719b463977b5b7576e3141">C_COMPARTMENT</a> );
<a name="l00255"></a>00255           <span class="keywordflow">throw</span> <a class="code" href="classSpkCompilerException.html">SpkCompilerException</a>( <a class="code" href="classSpkCompilerError.html#2743acfc3b04803a497c786509f4935d4e4b1ec6c464e05ae32a4d749471492e">SpkCompilerError::ASPK_USER_ERR</a>, mess, __LINE__, __FILE__ );
<a name="l00256"></a>00256     }
<a name="l00257"></a>00257     }
<a name="l00258"></a>00258   <span class="keywordflow">else</span>
<a name="l00259"></a>00259     {
<a name="l00260"></a>00260       nUserCompartments = compartment_list-&gt;getLength();
<a name="l00261"></a>00261     }
<a name="l00262"></a>00262 
<a name="l00263"></a>00263   <span class="comment">// #of equilibrim compartments. Default = 0.</span>
<a name="l00264"></a>00264   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nEquilibrims = 0;
<a name="l00265"></a>00265   <span class="keywordflow">if</span>( comp_model-&gt;hasAttribute( <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#e6bc00b8de2433946ad745cad7c5dbbd">X_NEQUILIBRIMS</a> ) )
<a name="l00266"></a>00266     {
<a name="l00267"></a>00267       <span class="keyword">const</span> XMLCh* x_nequilibrims = comp_model-&gt;getAttribute( <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#e6bc00b8de2433946ad745cad7c5dbbd">X_NEQUILIBRIMS</a> );
<a name="l00268"></a>00268       <span class="keywordflow">if</span>( ! XMLString::textToBin( x_nequilibrims, nEquilibrims ) )
<a name="l00269"></a>00269     {
<a name="l00270"></a>00270           <span class="keywordtype">char</span> mess[ <a class="code" href="classSpkCompilerError.html#e122376e543be6c83edef715c92599e1">SpkCompilerError::maxMessageLen</a>() ];
<a name="l00271"></a>00271           snprintf( mess,
<a name="l00272"></a>00272             SpkCompilerError::maxMessageLen(),
<a name="l00273"></a>00273             <span class="stringliteral">"Invalid &lt;%s::%s&gt; attribute value: \"%s\""</span>, <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#0e9855a6ea7370809e66a72a064920a2">C_COMP_MODEL</a>, <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#8e30cd0ffa84328f434638b83447ba70">C_NEQUILIBRIMS</a>,
<a name="l00274"></a>00274             XMLString::transcode(x_nequilibrims) );
<a name="l00275"></a>00275           <a class="code" href="classSpkCompilerException.html">SpkCompilerException</a> e( <a class="code" href="classSpkCompilerError.html#2743acfc3b04803a497c786509f4935d4e4b1ec6c464e05ae32a4d749471492e">SpkCompilerError::ASPK_USER_ERR</a>, mess, __LINE__, __FILE__);
<a name="l00276"></a>00276           <span class="keywordflow">throw</span> e;
<a name="l00277"></a>00277     } 
<a name="l00278"></a>00278     }
<a name="l00279"></a>00279 
<a name="l00280"></a>00280   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nParameters = 0; 
<a name="l00281"></a>00281   <span class="keywordflow">if</span>( comp_model-&gt;hasAttribute( <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#e61f8307c5ea09a065fc3b0a5ad1d79d">X_NPARAMETERS</a> ) )
<a name="l00282"></a>00282     {
<a name="l00283"></a>00283       <span class="keyword">const</span> XMLCh* x_nparameters = comp_model-&gt;getAttribute( <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#e61f8307c5ea09a065fc3b0a5ad1d79d">X_NPARAMETERS</a> );
<a name="l00284"></a>00284       <span class="keywordflow">if</span>( ! XMLString::textToBin( x_nparameters, nParameters ) )
<a name="l00285"></a>00285     {
<a name="l00286"></a>00286           <span class="keywordtype">char</span> mess[ <a class="code" href="classSpkCompilerError.html#e122376e543be6c83edef715c92599e1">SpkCompilerError::maxMessageLen</a>() ];
<a name="l00287"></a>00287           snprintf( mess,
<a name="l00288"></a>00288             SpkCompilerError::maxMessageLen(),
<a name="l00289"></a>00289             <span class="stringliteral">"Invalid &lt;%s::%s&gt; attribute value: \"%s\""</span>, <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#0e9855a6ea7370809e66a72a064920a2">C_COMP_MODEL</a>, <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#f10dbb04aed77f1ec70a08cdb0929f45">C_NPARAMETERS</a>,
<a name="l00290"></a>00290             XMLString::transcode(x_nparameters) );
<a name="l00291"></a>00291           <a class="code" href="classSpkCompilerException.html">SpkCompilerException</a> e( <a class="code" href="classSpkCompilerError.html#2743acfc3b04803a497c786509f4935d4e4b1ec6c464e05ae32a4d749471492e">SpkCompilerError::ASPK_USER_ERR</a>, mess, __LINE__, __FILE__);
<a name="l00292"></a>00292           <span class="keywordflow">throw</span> e;
<a name="l00293"></a>00293     } 
<a name="l00294"></a>00294     }
<a name="l00295"></a>00295 
<a name="l00296"></a>00296   <span class="comment">// Compartments</span>
<a name="l00297"></a>00297   <span class="keywordtype">bool</span> tempVal = <span class="keyword">false</span>;
<a name="l00298"></a>00298   <a class="code" href="classNonmemTranslator.html#f619a2db9666bbe079a036af27c6fe5f">myCompModel</a> = <span class="keyword">new</span> <a class="code" href="classCompModelInfo.html">CompModelInfo</a>( nUserCompartments+1 <span class="comment">/* Including the output compartment */</span>, 
<a name="l00299"></a>00299                    nParameters, 
<a name="l00300"></a>00300                    nEquilibrims,
<a name="l00301"></a>00301                    relTol );
<a name="l00302"></a>00302   
<a name="l00303"></a>00303   <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0; i&lt;nUserCompartments; i++ )
<a name="l00304"></a>00304     {
<a name="l00305"></a>00305       DOMElement* compartment = dynamic_cast&lt;DOMElement*&gt;( compartment_list-&gt;item(i) );
<a name="l00306"></a>00306       <span class="keywordflow">if</span>( compartment-&gt;hasAttribute( <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#0ac710be69df03ec5972f33a76f276d2">X_NAME</a> ) )
<a name="l00307"></a>00307     <a class="code" href="classNonmemTranslator.html#f619a2db9666bbe079a036af27c6fe5f">myCompModel</a>-&gt;<a class="code" href="classCompModelInfo.html#194bea9b51f16cdb2fbeb699705a7c24">getCompartment</a>(i).<a class="code" href="classCompartmentInfo.html#c9775caacdc1d8cf456a41da8460df96">setName</a>( XMLString::transcode( compartment-&gt;getAttribute( <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#0ac710be69df03ec5972f33a76f276d2">X_NAME</a> ) ) );
<a name="l00308"></a>00308       <span class="keywordflow">if</span>( compartment-&gt;hasAttribute( <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#2ba5d07a08283c5544ebaae67ed42362">X_INITIAL_OFF</a> ) )
<a name="l00309"></a>00309     {
<a name="l00310"></a>00310       <span class="keyword">const</span> XMLCh * yn = compartment-&gt;getAttribute( <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#2ba5d07a08283c5544ebaae67ed42362">X_INITIAL_OFF</a> );
<a name="l00311"></a>00311       <span class="keywordflow">if</span>( XMLString::equals( yn, <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#87a5b7b68d8a2933903af5dc44d58854">X_YES</a> ) )
<a name="l00312"></a>00312         tempVal = <span class="keyword">true</span>;
<a name="l00313"></a>00313       <span class="keywordflow">else</span>
<a name="l00314"></a>00314         tempVal = <span class="keyword">false</span>;
<a name="l00315"></a>00315       <a class="code" href="classNonmemTranslator.html#f619a2db9666bbe079a036af27c6fe5f">myCompModel</a>-&gt;<a class="code" href="classCompModelInfo.html#194bea9b51f16cdb2fbeb699705a7c24">getCompartment</a>(i).<a class="code" href="classCompartmentInfo.html#56f31c4006d638807dde819ad9fdce66">set_initial_off</a>( tempVal );
<a name="l00316"></a>00316     }
<a name="l00317"></a>00317       <span class="keywordflow">if</span>( compartment-&gt;hasAttribute( <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#9053b34e1c8a2881605b58fe2d82d075">X_NO_OFF</a> ) )
<a name="l00318"></a>00318     {
<a name="l00319"></a>00319       <span class="keyword">const</span> XMLCh * yn = compartment-&gt;getAttribute( <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#9053b34e1c8a2881605b58fe2d82d075">X_NO_OFF</a> );
<a name="l00320"></a>00320       <span class="keywordflow">if</span>( XMLString::equals( yn, <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#87a5b7b68d8a2933903af5dc44d58854">X_YES</a> ) )
<a name="l00321"></a>00321         tempVal = <span class="keyword">true</span>;
<a name="l00322"></a>00322       <span class="keywordflow">else</span>
<a name="l00323"></a>00323         tempVal = <span class="keyword">false</span>;
<a name="l00324"></a>00324       <a class="code" href="classNonmemTranslator.html#f619a2db9666bbe079a036af27c6fe5f">myCompModel</a>-&gt;<a class="code" href="classCompModelInfo.html#194bea9b51f16cdb2fbeb699705a7c24">getCompartment</a>(i).<a class="code" href="classCompartmentInfo.html#2f84e73a9180e9eff9940a5c2b7384df">set_no_off</a>( tempVal );
<a name="l00325"></a>00325     }
<a name="l00326"></a>00326       <span class="keywordflow">if</span>( compartment-&gt;hasAttribute( <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#97a01fe22a1c6fd37eb9f40e2f50fa16">X_NO_DOSE</a> ) )
<a name="l00327"></a>00327     {
<a name="l00328"></a>00328       <span class="keyword">const</span> XMLCh * yn = compartment-&gt;getAttribute( <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#97a01fe22a1c6fd37eb9f40e2f50fa16">X_NO_DOSE</a> );
<a name="l00329"></a>00329       <span class="keywordflow">if</span>( XMLString::equals( yn, <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#87a5b7b68d8a2933903af5dc44d58854">X_YES</a> ) )
<a name="l00330"></a>00330         tempVal = <span class="keyword">true</span>;
<a name="l00331"></a>00331       <span class="keywordflow">else</span>
<a name="l00332"></a>00332         tempVal = <span class="keyword">false</span>;
<a name="l00333"></a>00333       <a class="code" href="classNonmemTranslator.html#f619a2db9666bbe079a036af27c6fe5f">myCompModel</a>-&gt;<a class="code" href="classCompModelInfo.html#194bea9b51f16cdb2fbeb699705a7c24">getCompartment</a>(i).<a class="code" href="classCompartmentInfo.html#e189b5a4aef91de4575439f3316f86a4">set_no_dose</a>( tempVal );
<a name="l00334"></a>00334     }
<a name="l00335"></a>00335       <span class="keywordflow">if</span>( compartment-&gt;hasAttribute( <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#d40cc7ddcd10745debb56c4c30392466">X_EQUILIBRIM</a> ) )
<a name="l00336"></a>00336     {
<a name="l00337"></a>00337       <span class="keyword">const</span> XMLCh * yn = compartment-&gt;getAttribute( <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#d40cc7ddcd10745debb56c4c30392466">X_EQUILIBRIM</a> );
<a name="l00338"></a>00338       <span class="keywordflow">if</span>( XMLString::equals( yn, <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#87a5b7b68d8a2933903af5dc44d58854">X_YES</a> ) )
<a name="l00339"></a>00339         tempVal = <span class="keyword">true</span>;
<a name="l00340"></a>00340       <span class="keywordflow">else</span>
<a name="l00341"></a>00341         tempVal = <span class="keyword">false</span>;
<a name="l00342"></a>00342       <a class="code" href="classNonmemTranslator.html#f619a2db9666bbe079a036af27c6fe5f">myCompModel</a>-&gt;<a class="code" href="classCompModelInfo.html#194bea9b51f16cdb2fbeb699705a7c24">getCompartment</a>(i).<a class="code" href="classCompartmentInfo.html#a88e93df41792c22d05964e075f5ed84">set_equilibrim</a>( tempVal );
<a name="l00343"></a>00343     }
<a name="l00344"></a>00344       <span class="keywordflow">if</span>( compartment-&gt;hasAttribute( <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#61504fd3db4f4a50c344b90ad9bfb8c2">X_EXCLUDE</a> ) )
<a name="l00345"></a>00345     {
<a name="l00346"></a>00346       <span class="keyword">const</span> XMLCh * yn = compartment-&gt;getAttribute( <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#61504fd3db4f4a50c344b90ad9bfb8c2">X_EXCLUDE</a> );
<a name="l00347"></a>00347       <span class="keywordflow">if</span>( XMLString::equals( yn, <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#87a5b7b68d8a2933903af5dc44d58854">X_YES</a> ) )
<a name="l00348"></a>00348         tempVal = <span class="keyword">true</span>;
<a name="l00349"></a>00349       <span class="keywordflow">else</span>
<a name="l00350"></a>00350         tempVal = <span class="keyword">false</span>;
<a name="l00351"></a>00351       <a class="code" href="classNonmemTranslator.html#f619a2db9666bbe079a036af27c6fe5f">myCompModel</a>-&gt;<a class="code" href="classCompModelInfo.html#194bea9b51f16cdb2fbeb699705a7c24">getCompartment</a>(i).<a class="code" href="classCompartmentInfo.html#ccbeceab95b6bb5a18e07d403db39bdb">set_exclude</a>( tempVal );
<a name="l00352"></a>00352     }
<a name="l00353"></a>00353       <span class="keywordflow">if</span>( compartment-&gt;hasAttribute( <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#66251e0e690c0c49b96eaf0c97b5c224">X_DEFAULT_OBSERVATION</a> ) )
<a name="l00354"></a>00354     {
<a name="l00355"></a>00355       <span class="keyword">const</span> XMLCh * yn = compartment-&gt;getAttribute( <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#66251e0e690c0c49b96eaf0c97b5c224">X_DEFAULT_OBSERVATION</a> );
<a name="l00356"></a>00356       <span class="keywordflow">if</span>( XMLString::equals( yn, <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#87a5b7b68d8a2933903af5dc44d58854">X_YES</a> ) )
<a name="l00357"></a>00357         tempVal = <span class="keyword">true</span>;
<a name="l00358"></a>00358       <span class="keywordflow">else</span>
<a name="l00359"></a>00359         tempVal = <span class="keyword">false</span>;
<a name="l00360"></a>00360       <a class="code" href="classNonmemTranslator.html#f619a2db9666bbe079a036af27c6fe5f">myCompModel</a>-&gt;<a class="code" href="classCompModelInfo.html#194bea9b51f16cdb2fbeb699705a7c24">getCompartment</a>(i).<a class="code" href="classCompartmentInfo.html#2c50be07f150ef49609020a465a7990d">set_default_observation</a>( tempVal );
<a name="l00361"></a>00361     }
<a name="l00362"></a>00362       <span class="keywordflow">if</span>( compartment-&gt;hasAttribute( <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#a07b7e7e949d14ad5f93f16658a96be6">X_DEFAULT_DOSE</a> ) )
<a name="l00363"></a>00363     {
<a name="l00364"></a>00364       <span class="keyword">const</span> XMLCh * yn = compartment-&gt;getAttribute( <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#a07b7e7e949d14ad5f93f16658a96be6">X_DEFAULT_DOSE</a> );
<a name="l00365"></a>00365       <span class="keywordflow">if</span>( XMLString::equals( yn, <a class="code" href="classNonmemTranslator.html#b512bc7fc7a667800c68892fe94cc8a7">XML</a>.<a class="code" href="structXmlConstants.html#87a5b7b68d8a2933903af5dc44d58854">X_YES</a> ) )
<a name="l00366"></a>00366         tempVal = <span class="keyword">true</span>;
<a name="l00367"></a>00367       <span class="keywordflow">else</span>
<a name="l00368"></a>00368         tempVal = <span class="keyword">false</span>;
<a name="l00369"></a>00369       <a class="code" href="classNonmemTranslator.html#f619a2db9666bbe079a036af27c6fe5f">myCompModel</a>-&gt;<a class="code" href="classCompModelInfo.html#194bea9b51f16cdb2fbeb699705a7c24">getCompartment</a>(i).<a class="code" href="classCompartmentInfo.html#06315340cb78fec0d2ba937e52c01d6f">set_default_dose</a>( tempVal );
<a name="l00370"></a>00370     }  
<a name="l00371"></a>00371     }
<a name="l00372"></a>00372   <span class="keywordflow">return</span> nUserCompartments + 1;
<a name="l00373"></a>00373 }
<a name="l00374"></a>00374 <span class="keywordtype">void</span> <a class="code" href="classNonmemTranslator.html#bcac497ec004de569a7ced660f2c16df">NonmemTranslator::parsePK</a>( <span class="keyword">const</span> DOMElement* pk )
<a name="l00375"></a>00375 {
<a name="l00376"></a>00376   <span class="comment">//============================</span>
<a name="l00377"></a>00377   <span class="comment">// &lt;pk&gt;</span>
<a name="l00378"></a>00378   <span class="comment">//============================</span>
<a name="l00379"></a>00379   <span class="keywordtype">char</span> * c_pk_def = NULL;
<a name="l00380"></a>00380   <span class="keyword">const</span> XMLCh* xml_pk_def = pk-&gt;getFirstChild()-&gt;getNodeValue();
<a name="l00381"></a>00381   <span class="keywordtype">int</span> pk_size = XMLString::stringLen( xml_pk_def );
<a name="l00382"></a>00382 
<a name="l00383"></a>00383   <span class="keywordflow">if</span>( pk_size &gt; 0 )
<a name="l00384"></a>00384     c_pk_def = XMLString::transcode( xml_pk_def );
<a name="l00385"></a>00385 
<a name="l00386"></a>00386   <span class="comment">// REVISIT Sachiko 08/05/2005</span>
<a name="l00387"></a>00387   <span class="comment">//</span>
<a name="l00388"></a>00388   <span class="comment">// This value is assumed to be the same as NPARAMETERS given in $MODEL.</span>
<a name="l00389"></a>00389   <span class="comment">// Maybe wrong...</span>
<a name="l00390"></a>00390   <span class="keywordtype">int</span> nP_elements = <a class="code" href="countStrInLhs_8cpp.html#137454cb931f6240cb85b6eba65f9b33">countStrInLhs</a>( <a class="code" href="namespacenonmem.html#8d8a18780250fe2eee7149832898c10f">nonmem::P</a>.c_str(), c_pk_def );
<a name="l00391"></a>00391 
<a name="l00392"></a>00392   <a class="code" href="NonmemTranslator_8h.html#d49a5378adcaff1f6c822609dd9bda00">nm_in</a> = fopen( <a class="code" href="classNonmemTranslator.html#0f27681454957608940e9c53b18f4e89">fPkEqn_fortran</a>, <span class="stringliteral">"w"</span> );
<a name="l00393"></a>00393   fprintf( <a class="code" href="NonmemTranslator_8h.html#d49a5378adcaff1f6c822609dd9bda00">nm_in</a>, <span class="stringliteral">"%s"</span>, c_pk_def );
<a name="l00394"></a>00394   fclose( <a class="code" href="NonmemTranslator_8h.html#d49a5378adcaff1f6c822609dd9bda00">nm_in</a> );
<a name="l00395"></a>00395   <span class="keyword">delete</span> c_pk_def;
<a name="l00396"></a>00396 
<a name="l00397"></a>00397   <a class="code" href="NonmemTranslator_8h.html#d49a5378adcaff1f6c822609dd9bda00">nm_in</a> = fopen( <a class="code" href="classNonmemTranslator.html#0f27681454957608940e9c53b18f4e89">fPkEqn_fortran</a>, <span class="stringliteral">"r"</span> );
<a name="l00398"></a>00398   <a class="code" href="NonmemTranslator_8h.html#aa1af48cb54898cc7bda858530b77e6e">gSpkExpOutput</a> = fopen( <a class="code" href="classNonmemTranslator.html#fc46ecdc569eb5e7048356d3a372d184">fPkEqn_cpp</a>, <span class="stringliteral">"w"</span> );
<a name="l00399"></a>00399   <a class="code" href="NonmemTranslator_8h.html#59c9fe4d67b90da50e2c521ee2f9cae5">gSpkExpSymbolTable</a> = <a class="code" href="classNonmemTranslator.html#7cdb34ced820cc22c242e85e710aa076">table</a>;
<a name="l00400"></a>00400   <a class="code" href="NonmemTranslator_8h.html#6fb7247531b2c376ca2ef32003603819">gSpkExpErrors</a> = 0;
<a name="l00401"></a>00401   <a class="code" href="NonmemTranslator_8h.html#1eb091dbe3a2c163791e001931df7790">gSpkExpLines</a>  = 0;
<a name="l00402"></a>00402   <a class="code" href="NonmemTranslator_8h.html#ba17615c18ba8ebd6775d37838084c00">gSpkIsTInRhs</a>  = <span class="keyword">false</span>;
<a name="l00403"></a>00403   <a class="code" href="NonmemTranslator_8h.html#444ba98095e6a70ac02c96b7607b0e88">gSpkExpErrorMessages</a> = <span class="keyword">new</span> <span class="keywordtype">char</span>[ <a class="code" href="classSpkCompilerError.html#e122376e543be6c83edef715c92599e1">SpkCompilerError::maxMessageLen</a>()-50 ];
<a name="l00404"></a>00404   strcpy( <a class="code" href="NonmemTranslator_8h.html#444ba98095e6a70ac02c96b7607b0e88">gSpkExpErrorMessages</a>, <span class="stringliteral">""</span> );
<a name="l00405"></a>00405 
<a name="l00406"></a>00406   <a class="code" href="NonmemTranslator_8h.html#8fb058aa4e280dfc2e0b60a663981d30">nm_parse</a>();
<a name="l00407"></a>00407 
<a name="l00408"></a>00408   fclose( <a class="code" href="NonmemTranslator_8h.html#d49a5378adcaff1f6c822609dd9bda00">nm_in</a> );
<a name="l00409"></a>00409   fclose( <a class="code" href="NonmemTranslator_8h.html#aa1af48cb54898cc7bda858530b77e6e">gSpkExpOutput</a> );
<a name="l00410"></a>00410   <span class="keywordflow">if</span>( <a class="code" href="NonmemTranslator_8h.html#6fb7247531b2c376ca2ef32003603819">gSpkExpErrors</a> &gt; 0 )
<a name="l00411"></a>00411     {
<a name="l00412"></a>00412       <span class="keywordtype">char</span> m[ <a class="code" href="classSpkCompilerError.html#e122376e543be6c83edef715c92599e1">SpkCompilerError::maxMessageLen</a>() ];
<a name="l00413"></a>00413       snprintf( m, 
<a name="l00414"></a>00414         SpkCompilerError::maxMessageLen(),
<a name="l00415"></a>00415         <span class="stringliteral">"Syntax error(s) found in &lt;pk&gt; definition.\n%s"</span>, 
<a name="l00416"></a>00416         <a class="code" href="NonmemTranslator_8h.html#444ba98095e6a70ac02c96b7607b0e88">gSpkExpErrorMessages</a> );
<a name="l00417"></a>00417       <a class="code" href="classSpkCompilerException.html">SpkCompilerException</a> e( <a class="code" href="classSpkCompilerError.html#2743acfc3b04803a497c786509f4935dbf7918d9e64556832eca4c5d3aa904da">SpkCompilerError::ASPK_SOURCEML_ERR</a>, 
<a name="l00418"></a>00418                   m, __LINE__, __FILE__ );
<a name="l00419"></a>00419       <span class="keywordflow">throw</span> e;
<a name="l00420"></a>00420     }
<a name="l00421"></a>00421   <span class="comment">// Find out if PK block is a function of the continuous time.</span>
<a name="l00422"></a>00422   <span class="comment">// (T appears on the right hand side?)</span>
<a name="l00423"></a>00423   <span class="comment">//</span>
<a name="l00424"></a>00424   <a class="code" href="classNonmemTranslator.html#f619a2db9666bbe079a036af27c6fe5f">myCompModel</a>-&gt;<a class="code" href="classCompModelInfo.html#7b87707130c5a43fe8fd89e29a3515ca">setPkFunctionOfT</a>( <a class="code" href="NonmemTranslator_8h.html#ba17615c18ba8ebd6775d37838084c00">gSpkIsTInRhs</a> );
<a name="l00425"></a>00425 
<a name="l00426"></a>00426   remove( <a class="code" href="classNonmemTranslator.html#0f27681454957608940e9c53b18f4e89">fPkEqn_fortran</a> );
<a name="l00427"></a>00427 }
<a name="l00428"></a>00428 <span class="keywordtype">void</span> <a class="code" href="classNonmemTranslator.html#73350b7a1b144fed8551546754db4e0f">NonmemTranslator::parseDiffEqn</a>( <span class="keyword">const</span> DOMElement* diffeqn )
<a name="l00429"></a>00429 {    
<a name="l00430"></a>00430   <span class="comment">//============================</span>
<a name="l00431"></a>00431   <span class="comment">// &lt;diffeqn&gt;</span>
<a name="l00432"></a>00432   <span class="comment">//============================</span>
<a name="l00433"></a>00433   <span class="comment">//--------------------------------------------------------------</span>
<a name="l00434"></a>00434   <span class="comment">// Figure out the # of compartments/differential equations</span>
<a name="l00435"></a>00435   <span class="comment">// The value is equal to the number of occurences of DADT</span>
<a name="l00436"></a>00436   <span class="comment">// left-hand quantities in &lt;diffeqn&gt; block.</span>
<a name="l00437"></a>00437   <span class="comment">//--------------------------------------------------------------</span>
<a name="l00438"></a>00438   <span class="keywordtype">char</span> * c_des_def = NULL;
<a name="l00439"></a>00439   <span class="keyword">const</span> XMLCh* xml_des_def = diffeqn-&gt;getFirstChild()-&gt;getNodeValue();
<a name="l00440"></a>00440   <span class="keywordtype">int</span> des_size = XMLString::stringLen( xml_des_def );
<a name="l00441"></a>00441 
<a name="l00442"></a>00442   <span class="keywordflow">if</span>( des_size &gt; 0 )
<a name="l00443"></a>00443     c_des_def = XMLString::transcode( xml_des_def );
<a name="l00444"></a>00444 
<a name="l00445"></a>00445   <span class="keywordtype">int</span> nCompsInDES = <a class="code" href="countStrInLhs_8cpp.html#137454cb931f6240cb85b6eba65f9b33">countStrInLhs</a>( <a class="code" href="namespacenonmem.html#f50e87d87f3f6c8fc97d5941d81ee4c0">nonmem::DADT</a>.c_str(), c_des_def );
<a name="l00446"></a>00446   <span class="keywordflow">if</span>( nCompsInDES != <a class="code" href="classNonmemTranslator.html#f619a2db9666bbe079a036af27c6fe5f">myCompModel</a>-&gt;<a class="code" href="classCompModelInfo.html#cdcfd540d1532d88dbf1e093e3d29acd">getNCompartments</a>()-1 )
<a name="l00447"></a>00447     {
<a name="l00448"></a>00448       <span class="keywordtype">char</span> m[ SpkCompilerError::maxMessageLen() ];
<a name="l00449"></a>00449       snprintf( m, 
<a name="l00450"></a>00450         SpkCompilerError::maxMessageLen(),
<a name="l00451"></a>00451         <span class="stringliteral">"The number of DADT elements appear on the left hand side of equations does not match with the number given in SpkSourceML document."</span> );
<a name="l00452"></a>00452       <span class="keywordflow">throw</span> <a class="code" href="classSpkCompilerException.html">SpkCompilerException</a>( <a class="code" href="classSpkCompilerError.html#2743acfc3b04803a497c786509f4935d4e4b1ec6c464e05ae32a4d749471492e">SpkCompilerError::ASPK_USER_ERR</a>, m, __LINE__, __FILE__ );
<a name="l00453"></a>00453     }
<a name="l00454"></a>00454   
<a name="l00455"></a>00455   <a class="code" href="NonmemTranslator_8h.html#d49a5378adcaff1f6c822609dd9bda00">nm_in</a> = fopen( <a class="code" href="classNonmemTranslator.html#83d372fabd387933465cfe52332df7fc">fDiffEqn_fortran</a>, <span class="stringliteral">"w"</span> );
<a name="l00456"></a>00456   fprintf( <a class="code" href="NonmemTranslator_8h.html#d49a5378adcaff1f6c822609dd9bda00">nm_in</a>, <span class="stringliteral">"%s"</span>, c_des_def );
<a name="l00457"></a>00457   fclose( <a class="code" href="NonmemTranslator_8h.html#d49a5378adcaff1f6c822609dd9bda00">nm_in</a> );
<a name="l00458"></a>00458   <span class="keyword">delete</span> c_des_def;
<a name="l00459"></a>00459 
<a name="l00460"></a>00460   <a class="code" href="NonmemTranslator_8h.html#d49a5378adcaff1f6c822609dd9bda00">nm_in</a> = fopen( <a class="code" href="classNonmemTranslator.html#83d372fabd387933465cfe52332df7fc">fDiffEqn_fortran</a>, <span class="stringliteral">"r"</span> );
<a name="l00461"></a>00461   <a class="code" href="NonmemTranslator_8h.html#aa1af48cb54898cc7bda858530b77e6e">gSpkExpOutput</a> = fopen( <a class="code" href="classNonmemTranslator.html#661e005953f42529edbf5ae285cee379">fDiffEqn_cpp</a>, <span class="stringliteral">"w"</span> );
<a name="l00462"></a>00462   <a class="code" href="NonmemTranslator_8h.html#59c9fe4d67b90da50e2c521ee2f9cae5">gSpkExpSymbolTable</a> = <a class="code" href="classNonmemTranslator.html#7cdb34ced820cc22c242e85e710aa076">table</a>;
<a name="l00463"></a>00463   <a class="code" href="NonmemTranslator_8h.html#6fb7247531b2c376ca2ef32003603819">gSpkExpErrors</a> = 0;
<a name="l00464"></a>00464   <a class="code" href="NonmemTranslator_8h.html#1eb091dbe3a2c163791e001931df7790">gSpkExpLines</a>  = 0;
<a name="l00465"></a>00465   <a class="code" href="NonmemTranslator_8h.html#444ba98095e6a70ac02c96b7607b0e88">gSpkExpErrorMessages</a> = <span class="keyword">new</span> <span class="keywordtype">char</span>[ <a class="code" href="classSpkCompilerError.html#e122376e543be6c83edef715c92599e1">SpkCompilerError::maxMessageLen</a>()-50 ];
<a name="l00466"></a>00466   strcpy( <a class="code" href="NonmemTranslator_8h.html#444ba98095e6a70ac02c96b7607b0e88">gSpkExpErrorMessages</a>, <span class="stringliteral">""</span> );
<a name="l00467"></a>00467 
<a name="l00468"></a>00468   <a class="code" href="NonmemTranslator_8h.html#8fb058aa4e280dfc2e0b60a663981d30">nm_parse</a>();
<a name="l00469"></a>00469 
<a name="l00470"></a>00470   fclose( <a class="code" href="NonmemTranslator_8h.html#d49a5378adcaff1f6c822609dd9bda00">nm_in</a> );
<a name="l00471"></a>00471   fclose( <a class="code" href="NonmemTranslator_8h.html#aa1af48cb54898cc7bda858530b77e6e">gSpkExpOutput</a> );
<a name="l00472"></a>00472   <span class="keywordflow">if</span>( <a class="code" href="NonmemTranslator_8h.html#6fb7247531b2c376ca2ef32003603819">gSpkExpErrors</a> &gt; 0 )
<a name="l00473"></a>00473     {
<a name="l00474"></a>00474       <span class="keywordtype">char</span> m[ <a class="code" href="classSpkCompilerError.html#e122376e543be6c83edef715c92599e1">SpkCompilerError::maxMessageLen</a>() ];
<a name="l00475"></a>00475       snprintf( m, 
<a name="l00476"></a>00476         SpkCompilerError::maxMessageLen(),
<a name="l00477"></a>00477         <span class="stringliteral">"Syntax error(s) found in &lt;diffeqn&gt; definition.\n%s"</span>, 
<a name="l00478"></a>00478         <a class="code" href="NonmemTranslator_8h.html#444ba98095e6a70ac02c96b7607b0e88">gSpkExpErrorMessages</a> );
<a name="l00479"></a>00479       <a class="code" href="classSpkCompilerException.html">SpkCompilerException</a> e( <a class="code" href="classSpkCompilerError.html#2743acfc3b04803a497c786509f4935dbf7918d9e64556832eca4c5d3aa904da">SpkCompilerError::ASPK_SOURCEML_ERR</a>, 
<a name="l00480"></a>00480                   m, __LINE__, __FILE__ );
<a name="l00481"></a>00481       <span class="keywordflow">throw</span> e;
<a name="l00482"></a>00482     }
<a name="l00483"></a>00483   remove( <a class="code" href="classNonmemTranslator.html#83d372fabd387933465cfe52332df7fc">fDiffEqn_fortran</a> );
<a name="l00484"></a>00484 }
<a name="l00485"></a>00485 <span class="keywordtype">void</span> <a class="code" href="classNonmemTranslator.html#3b890b9f5e9ca6221bdde45128afafad">NonmemTranslator::parseError</a>( <span class="keyword">const</span> DOMElement* error )
<a name="l00486"></a>00486 {
<a name="l00487"></a>00487   <span class="comment">//============================</span>
<a name="l00488"></a>00488   <span class="comment">// &lt;error&gt; block</span>
<a name="l00489"></a>00489   <span class="comment">//============================</span>
<a name="l00490"></a>00490   <span class="keywordtype">char</span> * c_error_def = NULL;
<a name="l00491"></a>00491   <span class="keyword">const</span> XMLCh* xml_error_def = error-&gt;getFirstChild()-&gt;getNodeValue();
<a name="l00492"></a>00492   <span class="keywordtype">int</span> error_size = XMLString::stringLen( xml_error_def );
<a name="l00493"></a>00493 
<a name="l00494"></a>00494   <span class="keywordflow">if</span>( error_size &gt; 0 )
<a name="l00495"></a>00495     c_error_def = XMLString::transcode( xml_error_def );
<a name="l00496"></a>00496 
<a name="l00497"></a>00497   <a class="code" href="NonmemTranslator_8h.html#d49a5378adcaff1f6c822609dd9bda00">nm_in</a> = fopen( <a class="code" href="classNonmemTranslator.html#fb8f47bcc3bc0842525318fc061b2440">fErrorEqn_fortran</a>, <span class="stringliteral">"w"</span> );
<a name="l00498"></a>00498   fprintf( <a class="code" href="NonmemTranslator_8h.html#d49a5378adcaff1f6c822609dd9bda00">nm_in</a>, <span class="stringliteral">"%s"</span>, c_error_def );
<a name="l00499"></a>00499   fclose( <a class="code" href="NonmemTranslator_8h.html#d49a5378adcaff1f6c822609dd9bda00">nm_in</a> );
<a name="l00500"></a>00500   <span class="keyword">delete</span> c_error_def;
<a name="l00501"></a>00501 
<a name="l00502"></a>00502   <a class="code" href="NonmemTranslator_8h.html#d49a5378adcaff1f6c822609dd9bda00">nm_in</a> = fopen( <a class="code" href="classNonmemTranslator.html#fb8f47bcc3bc0842525318fc061b2440">fErrorEqn_fortran</a>, <span class="stringliteral">"r"</span> );
<a name="l00503"></a>00503   <a class="code" href="NonmemTranslator_8h.html#aa1af48cb54898cc7bda858530b77e6e">gSpkExpOutput</a> = fopen( <a class="code" href="classNonmemTranslator.html#1cb8000599764b4d6db744b448655c05">fErrorEqn_cpp</a>, <span class="stringliteral">"w"</span> );
<a name="l00504"></a>00504   <a class="code" href="NonmemTranslator_8h.html#59c9fe4d67b90da50e2c521ee2f9cae5">gSpkExpSymbolTable</a> = <a class="code" href="classNonmemTranslator.html#7cdb34ced820cc22c242e85e710aa076">table</a>;
<a name="l00505"></a>00505   <a class="code" href="NonmemTranslator_8h.html#6fb7247531b2c376ca2ef32003603819">gSpkExpErrors</a> = 0;
<a name="l00506"></a>00506   <a class="code" href="NonmemTranslator_8h.html#1eb091dbe3a2c163791e001931df7790">gSpkExpLines</a>  = 0;
<a name="l00507"></a>00507   <a class="code" href="NonmemTranslator_8h.html#444ba98095e6a70ac02c96b7607b0e88">gSpkExpErrorMessages</a> = <span class="keyword">new</span> <span class="keywordtype">char</span>[ <a class="code" href="classSpkCompilerError.html#e122376e543be6c83edef715c92599e1">SpkCompilerError::maxMessageLen</a>()-50 ];
<a name="l00508"></a>00508   strcpy( <a class="code" href="NonmemTranslator_8h.html#444ba98095e6a70ac02c96b7607b0e88">gSpkExpErrorMessages</a>, <span class="stringliteral">""</span> );
<a name="l00509"></a>00509 
<a name="l00510"></a>00510   <a class="code" href="NonmemTranslator_8h.html#8fb058aa4e280dfc2e0b60a663981d30">nm_parse</a>();
<a name="l00511"></a>00511 
<a name="l00512"></a>00512   fclose( <a class="code" href="NonmemTranslator_8h.html#d49a5378adcaff1f6c822609dd9bda00">nm_in</a> );
<a name="l00513"></a>00513   fclose( <a class="code" href="NonmemTranslator_8h.html#aa1af48cb54898cc7bda858530b77e6e">gSpkExpOutput</a> );
<a name="l00514"></a>00514   <span class="keywordflow">if</span>( <a class="code" href="NonmemTranslator_8h.html#6fb7247531b2c376ca2ef32003603819">gSpkExpErrors</a> &gt; 0 )
<a name="l00515"></a>00515     {
<a name="l00516"></a>00516       <span class="keywordtype">char</span> m[ <a class="code" href="classSpkCompilerError.html#e122376e543be6c83edef715c92599e1">SpkCompilerError::maxMessageLen</a>() ];
<a name="l00517"></a>00517       snprintf( m, 
<a name="l00518"></a>00518         SpkCompilerError::maxMessageLen(),
<a name="l00519"></a>00519         <span class="stringliteral">"Syntax error(s) found in &lt;error&gt; definition.\n%s"</span>, 
<a name="l00520"></a>00520         <a class="code" href="NonmemTranslator_8h.html#444ba98095e6a70ac02c96b7607b0e88">gSpkExpErrorMessages</a> );
<a name="l00521"></a>00521       <a class="code" href="classSpkCompilerException.html">SpkCompilerException</a> e( <a class="code" href="classSpkCompilerError.html#2743acfc3b04803a497c786509f4935dbf7918d9e64556832eca4c5d3aa904da">SpkCompilerError::ASPK_SOURCEML_ERR</a>, 
<a name="l00522"></a>00522                   m, __LINE__, __FILE__ );
<a name="l00523"></a>00523       <span class="keywordflow">throw</span> e;
<a name="l00524"></a>00524     }
<a name="l00525"></a>00525   remove( <a class="code" href="classNonmemTranslator.html#fb8f47bcc3bc0842525318fc061b2440">fErrorEqn_fortran</a> );
<a name="l00526"></a>00526 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue May 20 15:28:23 2008 for SPK Compiler API Documentation by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
