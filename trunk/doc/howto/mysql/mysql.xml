<?xml version="1.0"?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook XML V4.2//EN"
      "http://www.oasis-open.org/docbook/xml/4.2/docbookx.dtd"
[
  <!ENTITY uw "University of Washington">
  <!ENTITY dept "Department of Bioengineering">
]>
<article><title>MySQL and Spk</title>
 <articleinfo>
    <revhistory>
      <revision>
	<revnumber>1.0</revnumber>
	<date>January 29, 2004</date>
	<authorinitials>afw</authorinitials>
	<revremark>Initial version.</revremark>
      </revision>
    </revhistory>
  <abstract>
      <para>
	The installation, use, and management of the MySQL relational
	database management system is discussed.
      </para>
  </abstract>
 </articleinfo>
  <sect1>
    <title>Introduction</title>
    <para>
      MySQL is a relational database management system that is available
      under an open source GPL license when included as a part of an
      application that also bears an open source license. Because Spk is
      distributed as open souce, this powerful
      tool can be distributed as part of Spk at no cost to users.
    </para>
    <para>
      Spk requires the ability to make updates to the database as
      <emphasis>atomic transactions.</emphasis>.  This feature was
      first available in Version 4 of MySQL. An Spk installation
      should, therefore, install MySQL Version 4.0 or later.
    </para>
    <para>
      This document describes how to install, configure, and 
      manage MySQL as part of Spk.
    </para>
  </sect1>
  <sect1>
    <title>Installing MySQL</title>
    <para>
      The following installation instructions are specific to 
      RPFK and RedHat Enterprise Linux version 3 (RHEL).
    </para>
    <sect2>
      <title>Installing the Database Software</title>
      <para>
	The preferred way to install software in an RHEL system is with 
	packages assembled for installation using the <command>rpm</command>
	command (Redhat Package Manager).  Files for <command>rpm</command>,
	which can be identified by the <filename>.rpm</filename> filename
	suffix, are available for MySQL at the 
	<ulink url="http://www.mysql.com/">MySQL</ulink> web site.  The needed
	files, however, have already been downloaded, and are available on
	<filename>whitechuck.rfpk.washington.edu</filename>.
      </para>
      <para>
	In a terminal window:
	<screen>
cd /tmp
scp whitechuck:/opt/download/mysql-db.tar .
tar xvf mysql-db.tar
su
cd mysql-db
rpm -Uhv *
rm -rf mysql-db.tar mysql-db
	</screen>
      </para>
      <para>
	After the set of command listed above have been executed, MySQL
	should be installed on your machine and the MySQL server should
	be running.  Furthermore, the server will start automatically
	each time that you boot your machine.
      </para>
    </sect2>
    <sect2>
      <title>Adding the Root User</title>
      <para>
	As the first step toward using your MySQL database, you must
	provide the MySQL root user with a password.  The MySQL 
	root user is not the same as the Linux root user, and should
	have a different password, because these two users have different
	roles and responsibilities.  
      </para>
      <para>
	In the following, assume that the password is 
	<emphasis>secret-code</emphasis>. Be certain, however, that you do
	not actually use <emphasis>secret-code</emphasis> as your password,
	but rather provide a string of alphabetic characters, digits, and
	special characters that is very difficult to guess.
      </para>
      <para>
	From a terminal window:
	<screen>
su 
/usr/bin/mysqladmin -u root password <emphasis>secret-code</emphasis>
	</screen>
      </para>
    </sect2>
    <sect2>
      <title>Creating the Databases</title>
      <para>
	In this step we will create two database,
	<emphasis>spkdb</emphasis> and <emphasis>spktest</emphasis>.	
	These databases will have exactly the same structure.
	For now, we will create them empty:
      </para>
      <para>
	<screen>
mysql -uroot -p
use mysql;
create database spkdb;
create database spktest;
quit;
	</screen>
      </para>
    </sect2>
    <sect2>
      <title>Adding the Test User</title>
      <para>
	For testing of software, we need a user with access
	rights to the <emphasis>spktest</emphasis> database.
	<screen>
mysql -u root -p
grant all on spktest.* to tester@localhost identified by 'tester';
grant all on spktest.* to tester@localhost.localdomain identified by 'tester';
grant all on spktest.* to tester@"%" identified by 'tester';
quit;
	</screen>
      </para>
    </sect2>
    <sect2>
      <title id="perl-access">Installing the Perl Access Modules</title>
      <para>
	To access any relational database from perl, the perl-DBI
	module must be installed.  For access to
	a MySQL database, the perl-DBD-MySQL module must be added.  The
	following procedure will install both of these modules on your machine.
	<screen>
cd /tmp
scp whitechuck:/opt/download/mysql-perl.tar .
tar xvf mysql-perl.tar
su
cd mysql-perl
rpm -Uhv *
exit
cd /tmp
rm -rf mysql-perl.tar mysql-perl
	</screen>
      </para>
    </sect2>
    <sect2>
      <title id="java">Installing Java</title>
      <para>
	If you want to use java to access the database and you do not already
	have the Java Software Development Kit (SDK) installed on your machine,
	follow these instructions.
	<screen>
cd /tmp
scp whitechuck:/opt/download/java.tar .
tar xvf java.tar
cd java
chmod +x *bin
./*bin
	</screen>
	At this point you will need to scroll down through a license 
	agreement and respond that <command>yes</command>, you
	accept it.
	<screen>
su
rpm -Uhv *.rpm
mv *.zip /usr/java
cd /usr/java
unzip *doc.zip
rm *doc.zip
exit
cd /tmp
rm -rf java java.tar
	</screen>
      </para>
      <para>
	Before you can use java, you will need to set up the 
	<command>JAVA_HOME</command> environment variable.  
	Add the following lines to your <filename>~/.bash_profile</filename>
	file:
	<screen>
JAVA_HOME=/usr/java/j2sdk1.4.2_03
export JAVA_HOME
	</screen>
	The above assumes that the SDK that you installed was
	<filename>j2sdk1.4.2_03</filename>. If it is different, this
	document needs to be updated, but you can simple adjust the 
	name to what is installed.
      </para>
      <para>
	Finally, log out of the desk top and log back in again.  This will 
	insure that all processes descendent from your desktop will have 
	<command>JAVA_HOME</command> set properly.
      </para>
    </sect2>
    <sect2>
      <title id="java-access">Installing the Java Access Classes</title>
      <para>
	To use java to access a MySQL database, you must have the
	mysql-connector-java jar installed on your machine.  The 
	following instructions will accomplish this.
	<screen>
cd /tmp
scp whitechuck:/opt/download/mysql-java.tar .
tar xvf mysql-java.tar
cd mysql-java
tar xvzf *
rm *.gz
cd mysql*
su
cp *.jar $JAVA_HOME/jre/lib/ext
exit
cd /tmp
rm -rf mysql-java.tar mysql-java
	</screen>
      </para>
    </sect2>
  </sect1>
  <sect1>
    <title>Installing the Spk Database Source</title>
    <para>
      The source for the Spk database API and administrative
      scripts is located in
      <filename>r2/src/apps/spk/db</filename> in the 
      <command>cvs</command> tree. You can copy the
      <filename>db</filename> subtree to another location,
      if you want to.
    </para>
    <sect2>
      <title>Installing and Testing the Perl API</title>
      <para>
	You will need to have the perl modules for access MySQL
	installed on your machine. If you have not done so, follow the
	instructions in the section
	"<link linkend="perl-access">Installing the Perl Access Modules</link>."
      </para>
      <para>
	Start in the 
	<filename>r2/src/apps/spk/db</filename> directory
	in a cvs workspace, or a copy of the subtree starting
	at <filename>db</filename>:
	<screen>
cd api/perl
perl Makefile.PL
make
make test
	</screen>
      </para>
      <para>
	If all the tests run correctly, complete the installation
	this way:
	<screen>
su
make install
	</screen>
      </para>
    </sect2>
    <sect2>
      <title>Installing and Testing the Java API</title>
      <para>
	You will need to have Java and the MySQL access classes
	installed on your machine. If you have not done so, follow the
	instructions in the sections
	"<link linkend="java">Installing Java</link>", and
	"<link linkend="java-access">Installing the Java Access Classes</link>."
      </para>
      <para>
	Start in the 
	<filename>r2/src/apps/spk/db</filename> directory
	in a cvs workspace, or a copy of the subtree starting
	at <filename>db</filename>:
	<screen>
cd api/java
make
make docs
make test
	</screen>
      </para>
      <para>
	The commands listed above will compile the rfpk.spk.spkdb package, 
	generate html documentation (using javadoc) and run the test suite.
      </para>
    </sect2>
  </sect1>
</article>
